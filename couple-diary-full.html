<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Êàë‰ª¨ÁöÑÊó•ËÆ∞Êú¨</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600&family=Noto+Serif+SC:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --color-deep: #5D4E42;
      --color-brown: #7A6555;
      --color-medium: #9B8574;
      --color-light: #BBA99A;
      --color-muted: #C9BDB0;
      --color-cream: #FAF7F4;
      --color-warm-white: #FDFCFB;
      --color-cat: #A67B5B;
      --color-dog: #7B8D9A;
      --color-accent: #D4B896;
      --color-success: #8DAD8A;
      --color-danger: #C49A9A;
      
      --shadow-xs: 0 1px 3px rgba(44, 36, 32, 0.04);
      --shadow-sm: 0 2px 8px rgba(44, 36, 32, 0.05);
      --shadow-md: 0 4px 16px rgba(44, 36, 32, 0.06);
      --shadow-lg: 0 8px 32px rgba(44, 36, 32, 0.08);
      --shadow-xl: 0 16px 48px rgba(44, 36, 32, 0.1);
      
      --radius-sm: 12px;
      --radius-md: 16px;
      --radius-lg: 24px;
      --radius-xl: 32px;
      
      --font-display: 'Playfair Display', 'Noto Serif SC', serif;
      --font-body: 'Noto Serif SC', 'PingFang SC', serif;
      
      --ease-out: cubic-bezier(0.16, 1, 0.3, 1);
      --ease-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html, body {
      height: 100%;
    }

    body {
      font-family: var(--font-body);
      background: linear-gradient(180deg, #F5F2EF 0%, #EDE8E3 100%);
      color: var(--color-deep);
      min-height: 100vh;
      overflow-x: hidden;
      font-weight: 400;
      letter-spacing: 0.02em;
      line-height: 1.7;
    }

    /* Á∫πÁêÜËÉåÊôØ */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
      opacity: 0.03;
      pointer-events: none;
      z-index: 0;
    }

    .app {
      max-width: 430px;
      margin: 0 auto;
      min-height: 100vh;
      background: var(--color-warm-white);
      position: relative;
      box-shadow: 0 0 60px rgba(44, 36, 32, 0.08);
    }

    .page {
      display: none;
      min-height: 100vh;
      animation: pageIn 0.5s var(--ease-out);
    }

    .page.active {
      display: block;
    }

    @keyframes pageIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ==================== Ê¨¢ËøéÈ°µ ==================== */
    .welcome-page {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 60px 36px;
      text-align: center;
      background: 
        radial-gradient(ellipse at 30% 20%, rgba(196, 167, 125, 0.08) 0%, transparent 50%),
        radial-gradient(ellipse at 70% 80%, rgba(139, 115, 85, 0.06) 0%, transparent 50%),
        linear-gradient(180deg, var(--color-warm-white) 0%, var(--color-cream) 100%);
    }

    .welcome-brand {
      margin-bottom: 72px;
    }

    .welcome-logo {
      width: 88px;
      height: 88px;
      margin: 0 auto 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(145deg, var(--color-warm-white) 0%, var(--color-cream) 100%);
      border-radius: 50%;
      box-shadow: 
        var(--shadow-lg),
        inset 0 2px 4px rgba(255, 255, 255, 0.8),
        0 0 0 1px rgba(196, 167, 125, 0.1);
      animation: breathe 4s ease-in-out infinite;
    }

    @keyframes breathe {
      0%, 100% { transform: scale(1); box-shadow: var(--shadow-lg), inset 0 2px 4px rgba(255,255,255,0.8), 0 0 0 1px rgba(196,167,125,0.1); }
      50% { transform: scale(1.02); box-shadow: var(--shadow-xl), inset 0 2px 4px rgba(255,255,255,0.8), 0 0 0 1px rgba(196,167,125,0.15); }
    }

    .welcome-logo svg {
      width: 38px;
      height: 38px;
      fill: var(--color-brown);
    }

    .welcome-title {
      font-family: var(--font-display);
      font-size: 28px;
      font-weight: 500;
      letter-spacing: 0.08em;
      margin-bottom: 10px;
      background: linear-gradient(135deg, var(--color-deep) 0%, var(--color-brown) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .welcome-subtitle {
      font-size: 12px;
      color: var(--color-muted);
      letter-spacing: 0.25em;
      text-transform: uppercase;
    }

    .welcome-prompt {
      margin-bottom: 40px;
    }

    .welcome-prompt h2 {
      font-family: var(--font-display);
      font-size: 18px;
      font-weight: 400;
      color: var(--color-brown);
      margin-bottom: 6px;
    }

    .welcome-prompt p {
      font-size: 13px;
      color: var(--color-muted);
    }

    .identity-cards {
      display: flex;
      gap: 16px;
      margin-bottom: 48px;
    }

    .identity-card {
      width: 148px;
      padding: 32px 20px 28px;
      background: var(--color-warm-white);
      border: 1px solid rgba(196, 167, 125, 0.12);
      border-radius: var(--radius-lg);
      cursor: pointer;
      transition: all 0.4s var(--ease-out);
      box-shadow: var(--shadow-md);
      position: relative;
      overflow: hidden;
    }

    .identity-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, transparent, var(--color-accent), transparent);
      opacity: 0;
      transition: opacity 0.4s;
    }

    .identity-card:hover {
      transform: translateY(-6px);
      box-shadow: var(--shadow-xl);
      border-color: rgba(196, 167, 125, 0.25);
    }

    .identity-card:hover::before {
      opacity: 1;
    }

    .identity-card:active {
      transform: translateY(-3px) scale(0.98);
    }

    .identity-emoji {
      font-size: 42px;
      margin-bottom: 16px;
      display: block;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
    }

    .identity-name {
      font-size: 16px;
      font-weight: 500;
      margin-bottom: 4px;
    }

    .identity-hint {
      font-size: 11px;
      color: var(--color-muted);
      letter-spacing: 0.05em;
    }

    .identity-card.cat .identity-name { color: var(--color-cat); }
    .identity-card.dog .identity-name { color: var(--color-dog); }

    .stranger-link {
      font-size: 13px;
      color: var(--color-muted);
      cursor: pointer;
      transition: all 0.3s;
      padding: 8px 16px;
      border-radius: 100px;
    }

    .stranger-link:hover {
      color: var(--color-medium);
      background: rgba(196, 167, 125, 0.08);
    }

    /* ==================== È¶ñÈ°µ ==================== */
    .home-page {
      padding-bottom: 100px;
      background: var(--color-cream);
    }

    .home-header {
      padding: 52px 24px 20px;
      background: var(--color-warm-white);
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-brand h1 {
      font-family: var(--font-display);
      font-size: 22px;
      font-weight: 500;
      letter-spacing: 0.03em;
      margin-bottom: 4px;
    }

    .header-brand .couple-names {
      font-size: 12px;
      color: var(--color-muted);
      letter-spacing: 0.08em;
    }

    .user-avatar {
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--color-cream);
      border-radius: 50%;
      font-size: 22px;
      cursor: pointer;
      box-shadow: var(--shadow-sm);
      transition: all 0.3s;
    }

    .user-avatar:hover {
      transform: scale(1.05);
      box-shadow: var(--shadow-md);
    }

    /* Áä∂ÊÄÅÂç°ÁâáÂå∫ */
    .home-status {
      display: flex;
      gap: 12px;
      padding: 16px 16px 8px;
      background: var(--color-warm-white);
    }

    .status-card {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      background: linear-gradient(135deg, var(--color-cream) 0%, rgba(212, 184, 150, 0.15) 100%);
      border-radius: var(--radius-md);
      border: 1px solid rgba(212, 184, 150, 0.2);
    }

    .status-icon {
      font-size: 28px;
    }

    .status-info {
      flex: 1;
      min-width: 0;
    }

    .status-number {
      font-family: var(--font-display);
      font-size: 24px;
      font-weight: 600;
      color: var(--color-brown);
      line-height: 1.1;
    }

    .status-label {
      font-size: 11px;
      color: var(--color-muted);
      margin-top: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* ÂàÜÂå∫Ê†∑Âºè */
    .home-section {
      padding: 20px 16px 8px;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 14px;
      padding: 0 4px;
    }

    .section-title {
      font-size: 15px;
      font-weight: 500;
      color: var(--color-deep);
    }

    .section-action {
      background: none;
      border: none;
      font-family: var(--font-body);
      font-size: 12px;
      color: var(--color-accent);
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 100px;
      transition: all 0.3s;
    }

    .section-action:hover {
      background: rgba(212, 184, 150, 0.15);
    }

    /* Êñ∞Âä®ÊÄÅÂàóË°® */
    .updates-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .update-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 16px;
      background: var(--color-warm-white);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-xs);
      cursor: pointer;
      transition: all 0.3s;
    }

    .update-item:hover {
      box-shadow: var(--shadow-sm);
      transform: translateX(4px);
    }

    .update-item.unread {
      border-left: 3px solid var(--color-accent);
    }

    .update-avatar {
      font-size: 24px;
    }

    .update-content {
      flex: 1;
      min-width: 0;
    }

    .update-text {
      font-size: 13px;
      color: var(--color-deep);
      line-height: 1.5;
    }

    .update-text strong {
      color: var(--color-brown);
    }

    .update-time {
      font-size: 11px;
      color: var(--color-muted);
      margin-top: 2px;
    }

    .update-badge {
      width: 8px;
      height: 8px;
      background: var(--color-accent);
      border-radius: 50%;
    }

    .no-updates {
      text-align: center;
      padding: 24px;
      background: var(--color-warm-white);
      border-radius: var(--radius-md);
      color: var(--color-muted);
      font-size: 13px;
    }

    /* ÂõûÂøÜÂç°Áâá */
    .memory-card {
      background: 
        linear-gradient(135deg, var(--color-warm-white) 0%, rgba(212, 184, 150, 0.1) 100%);
      border-radius: var(--radius-lg);
      padding: 20px;
      box-shadow: var(--shadow-sm);
      border: 1px solid rgba(212, 184, 150, 0.15);
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }

    .memory-card::before {
      content: 'üìñ';
      position: absolute;
      top: -10px;
      right: -10px;
      font-size: 60px;
      opacity: 0.06;
    }

    .memory-card:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }

    .memory-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }

    .memory-tag {
      padding: 4px 10px;
      background: rgba(212, 184, 150, 0.2);
      border-radius: 100px;
      font-size: 11px;
      color: var(--color-brown);
    }

    .memory-date {
      font-size: 11px;
      color: var(--color-muted);
    }

    .memory-title {
      font-family: var(--font-display);
      font-size: 17px;
      font-weight: 500;
      color: var(--color-deep);
      margin-bottom: 8px;
    }

    .memory-preview {
      font-size: 13px;
      color: var(--color-medium);
      line-height: 1.7;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .memory-footer {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid rgba(212, 184, 150, 0.1);
    }

    .memory-author {
      font-size: 11px;
      color: var(--color-muted);
    }

    .search-bar {
      position: relative;
      margin-bottom: 12px;
    }

    .search-input {
      width: 100%;
      padding: 12px 16px 12px 42px;
      background: var(--color-warm-white);
      border: 1px solid rgba(212, 184, 150, 0.15);
      border-radius: var(--radius-md);
      font-family: var(--font-body);
      font-size: 13px;
      color: var(--color-deep);
      transition: all 0.3s var(--ease-out);
      box-shadow: var(--shadow-xs);
    }

    .search-input::placeholder {
      color: var(--color-muted);
    }

    .search-input:focus {
      outline: none;
      border-color: rgba(212, 184, 150, 0.4);
      box-shadow: var(--shadow-sm), 0 0 0 3px rgba(212, 184, 150, 0.1);
    }

    .search-icon {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      width: 16px;
      height: 16px;
      stroke: var(--color-muted);
      stroke-width: 2;
      fill: none;
    }

    .filter-bar {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      padding-bottom: 4px;
    }

    .filter-bar::-webkit-scrollbar {
      display: none;
    }

    .filter-btn {
      padding: 8px 14px;
      background: var(--color-warm-white);
      border: 1px solid rgba(212, 184, 150, 0.15);
      border-radius: 100px;
      font-family: var(--font-body);
      font-size: 12px;
      color: var(--color-medium);
      cursor: pointer;
      transition: all 0.3s var(--ease-out);
      white-space: nowrap;
      box-shadow: var(--shadow-xs);
    }

    .filter-btn:hover {
      border-color: rgba(212, 184, 150, 0.4);
      color: var(--color-brown);
    }

    .filter-btn.active {
      background: var(--color-brown);
      border-color: var(--color-brown);
      color: var(--color-cream);
      box-shadow: var(--shadow-sm);
    }

    .diary-list {
      padding: 8px 16px 24px;
    }

    .diary-card {
      background: var(--color-warm-white);
      border-radius: var(--radius-lg);
      padding: 24px;
      margin-bottom: 14px;
      box-shadow: var(--shadow-sm);
      cursor: pointer;
      transition: all 0.4s var(--ease-out);
      border: 1px solid transparent;
      position: relative;
      overflow: hidden;
    }

    .diary-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 3px;
      height: 100%;
      background: var(--color-accent);
      opacity: 0;
      transition: opacity 0.3s;
    }

    .diary-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
      border-color: rgba(196, 167, 125, 0.1);
    }

    .diary-card:hover::before {
      opacity: 1;
    }

    .diary-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 14px;
    }

    .diary-date {
      font-size: 11px;
      color: var(--color-muted);
      letter-spacing: 0.08em;
    }

    .diary-mood {
      font-size: 18px;
    }

    .diary-title {
      font-family: var(--font-display);
      font-size: 17px;
      font-weight: 500;
      margin-bottom: 8px;
      color: var(--color-deep);
      line-height: 1.5;
    }

    .diary-author {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 10px;
      background: var(--color-cream);
      border-radius: 100px;
      font-size: 10px;
      margin-bottom: 12px;
      font-weight: 500;
    }

    .diary-author.cat { color: var(--color-cat); }
    .diary-author.dog { color: var(--color-dog); }
    .diary-author.together { color: var(--color-brown); }

    .diary-preview {
      font-size: 13px;
      color: var(--color-medium);
      line-height: 1.8;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .diary-card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 16px;
      padding-top: 14px;
      border-top: 1px solid rgba(196, 167, 125, 0.08);
    }

    .diary-tags {
      display: flex;
      gap: 8px;
    }

    .diary-tag {
      font-size: 10px;
      color: var(--color-light);
      letter-spacing: 0.02em;
    }

    .diary-stats {
      display: flex;
      gap: 12px;
    }

    .diary-stat {
      font-size: 10px;
      color: var(--color-muted);
      display: flex;
      align-items: center;
      gap: 3px;
    }

    /* Á©∫Áä∂ÊÄÅ */
    .empty-state {
      text-align: center;
      padding: 60px 40px;
    }

    .empty-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.6;
    }

    .empty-text {
      font-size: 14px;
      color: var(--color-muted);
      margin-bottom: 20px;
    }

    .empty-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 12px 24px;
      background: var(--color-deep);
      color: var(--color-cream);
      border: none;
      border-radius: 100px;
      font-family: var(--font-body);
      font-size: 13px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .empty-btn:hover {
      background: var(--color-brown);
      transform: translateY(-2px);
    }

    /* ==================== ÂÜôÊó•ËÆ∞È°µ ==================== */
    .write-page {
      background: var(--color-warm-white);
      padding-bottom: 40px;
    }

    .write-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 20px;
      background: var(--color-warm-white);
      position: sticky;
      top: 0;
      z-index: 100;
      border-bottom: 1px solid rgba(196, 167, 125, 0.08);
    }

    .write-header h2 {
      font-family: var(--font-display);
      font-size: 18px;
      font-weight: 500;
    }

    .header-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 100px;
      font-family: var(--font-body);
      font-size: 13px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-ghost {
      background: transparent;
      color: var(--color-medium);
    }

    .btn-ghost:hover {
      background: var(--color-cream);
    }

    .btn-primary {
      background: var(--color-deep);
      color: var(--color-cream);
    }

    .btn-primary:hover {
      background: var(--color-brown);
    }

    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .write-form {
      padding: 24px;
    }

    .form-section {
      margin-bottom: 28px;
    }

    .form-label {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      color: var(--color-brown);
      margin-bottom: 12px;
      font-weight: 500;
    }

    .form-row {
      display: flex;
      gap: 12px;
    }

    .form-input {
      width: 100%;
      padding: 14px 18px;
      background: var(--color-cream);
      border: 1px solid transparent;
      border-radius: var(--radius-md);
      font-family: var(--font-body);
      font-size: 14px;
      color: var(--color-deep);
      transition: all 0.3s;
    }

    .form-input:focus {
      outline: none;
      background: var(--color-warm-white);
      border-color: rgba(196, 167, 125, 0.3);
      box-shadow: 0 0 0 3px rgba(196, 167, 125, 0.08);
    }

    .form-input::placeholder {
      color: var(--color-muted);
    }

    .form-textarea {
      min-height: 200px;
      resize: none;
      line-height: 1.9;
    }

    .char-count {
      text-align: right;
      font-size: 12px;
      margin-top: 8px;
      transition: color 0.3s;
    }

    .char-count.warning {
      color: var(--color-danger);
    }

    .char-count.ok {
      color: var(--color-success);
    }

    /* ÈÄâÊã©ÊåâÈíÆÁªÑ */
    .select-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .select-btn {
      padding: 10px 16px;
      background: var(--color-cream);
      border: 1px solid transparent;
      border-radius: var(--radius-sm);
      font-family: var(--font-body);
      font-size: 13px;
      color: var(--color-medium);
      cursor: pointer;
      transition: all 0.3s;
    }

    .select-btn:hover {
      border-color: rgba(196, 167, 125, 0.3);
    }

    .select-btn.active {
      background: var(--color-deep);
      color: var(--color-cream);
      border-color: var(--color-deep);
    }

    .mood-btn {
      font-size: 24px;
      padding: 10px 14px;
    }

    .tag-btn {
      font-size: 12px;
    }

    .tag-btn.active {
      background: var(--color-accent);
      border-color: var(--color-accent);
    }

    /* ==================== ËØ¶ÊÉÖÈ°µ ==================== */
    .detail-page {
      background: var(--color-warm-white);
      padding-bottom: 20px;
    }

    .detail-header {
      padding: 16px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      background: rgba(253, 252, 250, 0.95);
      backdrop-filter: blur(20px);
      z-index: 10;
      border-bottom: 1px solid rgba(196, 167, 125, 0.06);
    }

    .back-btn {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--color-cream);
      border: none;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.3s var(--ease-out);
    }

    .back-btn:hover {
      transform: scale(1.05);
      box-shadow: var(--shadow-sm);
    }

    .back-btn svg {
      width: 18px;
      height: 18px;
      stroke: var(--color-brown);
      stroke-width: 2;
      fill: none;
    }

    .detail-actions {
      display: flex;
      gap: 8px;
    }

    .action-btn {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      border: 1px solid rgba(196, 167, 125, 0.15);
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.3s var(--ease-out);
    }

    .action-btn:hover {
      background: var(--color-cream);
      border-color: transparent;
    }

    .action-btn svg {
      width: 16px;
      height: 16px;
      stroke: var(--color-medium);
      stroke-width: 2;
      fill: none;
    }

    .detail-content {
      padding: 24px;
    }

    .detail-meta {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .detail-date {
      font-size: 12px;
      color: var(--color-muted);
      letter-spacing: 0.05em;
    }

    .detail-author {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 5px 12px;
      background: var(--color-cream);
      border-radius: 100px;
      font-size: 11px;
      font-weight: 500;
    }

    .detail-author.cat { color: var(--color-cat); }
    .detail-author.dog { color: var(--color-dog); }

    .detail-mood {
      font-size: 18px;
    }

    .detail-title {
      font-family: var(--font-display);
      font-size: 26px;
      font-weight: 500;
      line-height: 1.4;
      margin-bottom: 28px;
      color: var(--color-deep);
    }

    .detail-text {
      font-size: 15px;
      line-height: 2;
      color: var(--color-brown);
      margin-bottom: 32px;
    }

    .detail-text p {
      margin-bottom: 1.2em;
    }

    .detail-photos {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 6px;
      margin-bottom: 28px;
      border-radius: var(--radius-md);
      overflow: hidden;
    }

    .detail-photo {
      aspect-ratio: 1;
      background: linear-gradient(135deg, var(--color-cream) 0%, rgba(196, 167, 125, 0.2) 100%);
      object-fit: cover;
    }

    .detail-tags {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 36px;
    }

    .detail-tag {
      padding: 8px 14px;
      background: var(--color-cream);
      border-radius: 100px;
      font-size: 11px;
      color: var(--color-medium);
    }

    /* ‰∫íÂä®Âå∫ */
    .interaction-section {
      background: var(--color-cream);
      border-radius: var(--radius-xl) var(--radius-xl) 0 0;
      padding: 28px 20px 32px;
      margin: 0 -24px;
    }

    .interaction-title {
      font-family: var(--font-display);
      font-size: 15px;
      font-weight: 500;
      color: var(--color-brown);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .comments-list {
      margin-bottom: 24px;
      max-height: 400px;
      overflow-y: auto;
    }

    .comment-item {
      margin-bottom: 14px;
      animation: commentIn 0.4s var(--ease-out);
    }

    @keyframes commentIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .comment-bubble {
      max-width: 85%;
      padding: 12px 16px;
      background: var(--color-warm-white);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-xs);
    }

    .comment-item.cat .comment-bubble {
      margin-right: auto;
      border-bottom-left-radius: 4px;
    }

    .comment-item.dog .comment-bubble {
      margin-left: auto;
      border-bottom-right-radius: 4px;
    }

    .comment-author {
      font-size: 10px;
      margin-bottom: 4px;
      letter-spacing: 0.05em;
      font-weight: 500;
    }

    .comment-item.cat .comment-author { color: var(--color-cat); }
    .comment-item.dog .comment-author { color: var(--color-dog); }

    .comment-text {
      font-size: 13px;
      color: var(--color-deep);
      line-height: 1.6;
    }

    .comment-time {
      font-size: 9px;
      color: var(--color-muted);
      margin-top: 6px;
      text-align: right;
    }

    .comment-item.action {
      text-align: center;
    }

    .comment-item.action .comment-bubble {
      display: inline-block;
      max-width: none;
      padding: 10px 20px;
      background: linear-gradient(135deg, rgba(196, 167, 125, 0.1) 0%, rgba(139, 115, 85, 0.08) 100%);
      border-radius: 100px;
      margin: 0 auto;
      box-shadow: none;
    }

    .action-content {
      font-size: 13px;
      color: var(--color-brown);
    }

    .quick-actions {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 18px;
      flex-wrap: wrap;
    }

    .quick-action-btn {
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--color-warm-white);
      border: none;
      border-radius: 50%;
      font-size: 22px;
      cursor: pointer;
      transition: all 0.3s var(--ease-spring);
      box-shadow: var(--shadow-sm);
    }

    .quick-action-btn:hover {
      transform: scale(1.15);
      box-shadow: var(--shadow-md);
    }

    .quick-action-btn:active {
      transform: scale(0.95);
    }

    .comment-input-wrap {
      display: flex;
      gap: 10px;
      padding: 14px;
      background: var(--color-warm-white);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
    }

    .comment-input {
      flex: 1;
      padding: 10px 0;
      border: none;
      background: transparent;
      font-family: var(--font-body);
      font-size: 14px;
      color: var(--color-deep);
    }

    .comment-input::placeholder {
      color: var(--color-muted);
    }

    .comment-input:focus {
      outline: none;
    }

    .send-btn {
      padding: 10px 18px;
      background: var(--color-deep);
      border: none;
      border-radius: var(--radius-md);
      color: var(--color-cream);
      font-family: var(--font-body);
      font-size: 13px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .send-btn:hover {
      background: var(--color-brown);
    }

    /* ==================== Êó•ÂéÜÈ°µ ==================== */
    .calendar-page {
      background: var(--color-cream);
      padding-bottom: 100px;
    }

    .calendar-header {
      padding: 56px 24px 24px;
      background: var(--color-warm-white);
      text-align: center;
    }

    .calendar-header h1 {
      font-family: var(--font-display);
      font-size: 24px;
      font-weight: 500;
      margin-bottom: 4px;
    }

    .calendar-header p {
      font-size: 12px;
      color: var(--color-muted);
    }

    .calendar-nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 24px;
      background: var(--color-warm-white);
    }

    .calendar-nav-btn {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--color-cream);
      border: none;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.3s;
    }

    .calendar-nav-btn:hover {
      background: rgba(196, 167, 125, 0.15);
    }

    .calendar-nav-btn svg {
      width: 16px;
      height: 16px;
      stroke: var(--color-brown);
      stroke-width: 2;
      fill: none;
    }

    .calendar-month {
      font-family: var(--font-display);
      font-size: 18px;
      font-weight: 500;
      color: var(--color-deep);
    }

    .calendar-grid {
      padding: 0 16px 20px;
      background: var(--color-warm-white);
    }

    .calendar-weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      margin-bottom: 12px;
    }

    .weekday {
      text-align: center;
      font-size: 11px;
      color: var(--color-muted);
      padding: 8px 0;
      letter-spacing: 0.05em;
    }

    .calendar-days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
    }

    .calendar-day {
      aspect-ratio: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: var(--color-cream);
      border: none;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
      font-family: var(--font-body);
    }

    .calendar-day:hover {
      background: rgba(196, 167, 125, 0.15);
    }

    .calendar-day.empty {
      background: transparent;
      cursor: default;
    }

    .calendar-day.today {
      background: var(--color-deep);
      color: var(--color-cream);
    }

    .calendar-day.selected {
      background: var(--color-accent);
      color: white;
    }

    .calendar-day.has-diary::after {
      content: '';
      position: absolute;
      bottom: 6px;
      width: 4px;
      height: 4px;
      background: var(--color-accent);
      border-radius: 50%;
    }

    .calendar-day.today.has-diary::after,
    .calendar-day.selected.has-diary::after {
      background: white;
    }

    .day-number {
      font-size: 14px;
      font-weight: 500;
    }

    /* Êó•ÂéÜ‰∏ãÊñπÂÜÖÂÆπ */
    .calendar-content {
      padding: 20px 16px;
    }

    .calendar-section {
      margin-bottom: 24px;
    }

    .calendar-section-title {
      font-size: 13px;
      color: var(--color-brown);
      font-weight: 500;
      margin-bottom: 12px;
      padding-left: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .calendar-card {
      background: var(--color-warm-white);
      border-radius: var(--radius-md);
      padding: 16px;
      margin-bottom: 10px;
      box-shadow: var(--shadow-xs);
      cursor: pointer;
      transition: all 0.3s;
    }

    .calendar-card:hover {
      box-shadow: var(--shadow-sm);
      transform: translateY(-1px);
    }

    .calendar-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .calendar-card-title {
      font-size: 14px;
      font-weight: 500;
      color: var(--color-deep);
    }

    .calendar-card-tag {
      font-size: 10px;
      padding: 3px 8px;
      border-radius: 100px;
      background: var(--color-cream);
      color: var(--color-medium);
    }

    .calendar-card-preview {
      font-size: 12px;
      color: var(--color-muted);
      line-height: 1.6;
    }

    /* Ê∑ªÂä†‰∫ãÈ°πÊåâÈíÆ */
    .add-event-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      width: 100%;
      padding: 14px;
      background: var(--color-warm-white);
      border: 1px dashed rgba(196, 167, 125, 0.3);
      border-radius: var(--radius-md);
      font-family: var(--font-body);
      font-size: 13px;
      color: var(--color-medium);
      cursor: pointer;
      transition: all 0.3s;
    }

    .add-event-btn:hover {
      border-color: var(--color-accent);
      color: var(--color-brown);
      background: rgba(196, 167, 125, 0.05);
    }

    /* ==================== Á∫™ÂøµÊó•È°µ ==================== */
    .anniversary-page {
      background: 
        radial-gradient(ellipse at 50% 0%, rgba(196, 167, 125, 0.1) 0%, transparent 50%),
        var(--color-cream);
      padding-bottom: 100px;
    }

    .anniversary-header {
      padding: 56px 24px 32px;
      text-align: center;
      background: var(--color-warm-white);
    }

    .anniversary-header h1 {
      font-family: var(--font-display);
      font-size: 24px;
      font-weight: 500;
      margin-bottom: 4px;
    }

    .anniversary-header p {
      font-size: 12px;
      color: var(--color-muted);
    }

    .anniversary-content {
      padding: 24px 16px;
    }

    .together-card {
      background: 
        linear-gradient(135deg, var(--color-warm-white) 0%, rgba(196, 167, 125, 0.08) 100%);
      border-radius: var(--radius-xl);
      padding: 40px 24px;
      text-align: center;
      margin-bottom: 28px;
      box-shadow: var(--shadow-md);
      border: 1px solid rgba(196, 167, 125, 0.1);
      position: relative;
      overflow: hidden;
    }

    .together-card::before {
      content: 'üíï';
      position: absolute;
      top: -20px;
      right: -20px;
      font-size: 100px;
      opacity: 0.05;
    }

    .together-label {
      font-size: 13px;
      color: var(--color-muted);
      margin-bottom: 8px;
      letter-spacing: 0.1em;
    }

    .together-days {
      font-family: var(--font-display);
      font-size: 64px;
      font-weight: 600;
      color: var(--color-brown);
      line-height: 1;
      margin-bottom: 4px;
    }

    .together-unit {
      font-size: 18px;
      color: var(--color-medium);
      margin-bottom: 16px;
    }

    .together-date {
      font-size: 12px;
      color: var(--color-muted);
    }

    .anniversary-list {
      margin-bottom: 20px;
    }

    .anniversary-item {
      background: var(--color-warm-white);
      border-radius: var(--radius-md);
      padding: 18px 20px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 16px;
      box-shadow: var(--shadow-xs);
      cursor: pointer;
      transition: all 0.3s;
    }

    .anniversary-item:hover {
      box-shadow: var(--shadow-sm);
      transform: translateX(4px);
    }

    .anniversary-icon {
      font-size: 28px;
    }

    .anniversary-info {
      flex: 1;
    }

    .anniversary-name {
      font-size: 14px;
      font-weight: 500;
      color: var(--color-deep);
      margin-bottom: 2px;
    }

    .anniversary-date {
      font-size: 11px;
      color: var(--color-muted);
    }

    .anniversary-countdown {
      text-align: right;
    }

    .countdown-number {
      font-family: var(--font-display);
      font-size: 22px;
      font-weight: 600;
      color: var(--color-accent);
    }

    .countdown-unit {
      font-size: 10px;
      color: var(--color-muted);
    }

    .add-anniversary-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      width: 100%;
      padding: 16px;
      background: var(--color-warm-white);
      border: 1px dashed rgba(196, 167, 125, 0.3);
      border-radius: var(--radius-md);
      font-family: var(--font-body);
      font-size: 13px;
      color: var(--color-medium);
      cursor: pointer;
      transition: all 0.3s;
    }

    .add-anniversary-btn:hover {
      border-color: var(--color-accent);
      color: var(--color-brown);
    }

    /* ==================== ÊàëÁöÑÈ°µÈù¢ ==================== */
    .mine-page {
      background: var(--color-cream);
      padding-bottom: 100px;
    }

    .mine-header {
      padding: 56px 24px 40px;
      background: 
        linear-gradient(180deg, var(--color-warm-white) 0%, var(--color-cream) 100%);
      text-align: center;
    }

    .mine-avatars {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 16px;
    }

    .mine-avatar {
      width: 56px;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--color-warm-white);
      border-radius: 50%;
      font-size: 28px;
      box-shadow: var(--shadow-sm);
    }

    .mine-heart {
      font-size: 20px;
    }

    .mine-names {
      font-family: var(--font-display);
      font-size: 18px;
      font-weight: 500;
      margin-bottom: 4px;
    }

    .mine-days {
      font-size: 12px;
      color: var(--color-muted);
    }

    .mine-current {
      margin-top: 16px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      background: var(--color-warm-white);
      border-radius: 100px;
      font-size: 12px;
      color: var(--color-medium);
      box-shadow: var(--shadow-xs);
    }

    .mine-stats {
      display: flex;
      justify-content: center;
      gap: 32px;
      padding: 24px;
      background: var(--color-warm-white);
      margin: 0 16px;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      transform: translateY(-20px);
    }

    .mine-stat {
      text-align: center;
    }

    .mine-stat-number {
      font-family: var(--font-display);
      font-size: 28px;
      font-weight: 600;
      color: var(--color-brown);
    }

    .mine-stat-label {
      font-size: 11px;
      color: var(--color-muted);
    }

    .mine-menu {
      padding: 0 16px;
    }

    .mine-menu-item {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 18px 20px;
      background: var(--color-warm-white);
      border-radius: var(--radius-md);
      margin-bottom: 10px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: var(--shadow-xs);
    }

    .mine-menu-item:hover {
      box-shadow: var(--shadow-sm);
      transform: translateX(4px);
    }

    .mine-menu-icon {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--color-cream);
      border-radius: var(--radius-sm);
      font-size: 18px;
    }

    .mine-menu-text {
      flex: 1;
      font-size: 14px;
      color: var(--color-deep);
    }

    .mine-menu-arrow {
      color: var(--color-muted);
      font-size: 14px;
    }

    /* ==================== Â∫ïÈÉ®ÂØºËà™ ==================== */
    .tab-bar {
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      max-width: 430px;
      display: flex;
      justify-content: space-around;
      padding: 12px 20px 28px;
      background: rgba(253, 252, 250, 0.98);
      backdrop-filter: blur(20px);
      border-top: 1px solid rgba(196, 167, 125, 0.08);
      z-index: 1000;
    }

    .tab-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      background: none;
      border: none;
      cursor: pointer;
      transition: all 0.3s var(--ease-out);
      padding: 6px 12px;
    }

    .tab-item svg {
      width: 22px;
      height: 22px;
      stroke: var(--color-muted);
      stroke-width: 1.8;
      fill: none;
      transition: all 0.3s var(--ease-out);
    }

    .tab-item span {
      font-size: 10px;
      color: var(--color-muted);
      letter-spacing: 0.03em;
      transition: all 0.3s var(--ease-out);
    }

    .tab-item.active svg {
      stroke: var(--color-brown);
    }

    .tab-item.active span {
      color: var(--color-brown);
    }

    .tab-item.center {
      position: relative;
      top: -14px;
    }

    .tab-item.center .tab-icon-wrap {
      width: 52px;
      height: 52px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--color-brown) 0%, var(--color-deep) 100%);
      border-radius: 50%;
      box-shadow: var(--shadow-lg);
    }

    .tab-item.center svg {
      stroke: var(--color-cream);
    }

    /* ==================== ÂºπÁ™ó ==================== */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(44, 36, 32, 0.5);
      backdrop-filter: blur(8px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      padding: 20px;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      width: 100%;
      max-width: 340px;
      background: var(--color-warm-white);
      border-radius: var(--radius-xl);
      padding: 36px 28px;
      text-align: center;
      box-shadow: var(--shadow-xl);
      animation: modalIn 0.4s var(--ease-out);
    }

    @keyframes modalIn {
      from { opacity: 0; transform: scale(0.95) translateY(10px); }
      to { opacity: 1; transform: scale(1) translateY(0); }
    }

    .modal-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }

    .modal-title {
      font-family: var(--font-display);
      font-size: 20px;
      font-weight: 500;
      color: var(--color-deep);
      margin-bottom: 8px;
    }

    .modal-subtitle {
      font-size: 13px;
      color: var(--color-muted);
      margin-bottom: 24px;
      line-height: 1.7;
    }

    .modal-input-wrap {
      margin-bottom: 20px;
    }

    .modal-input {
      width: 100%;
      padding: 14px 18px;
      background: var(--color-cream);
      border: 2px solid transparent;
      border-radius: var(--radius-md);
      font-family: var(--font-body);
      font-size: 15px;
      text-align: center;
      letter-spacing: 2px;
      color: var(--color-deep);
      transition: all 0.3s var(--ease-out);
    }

    .modal-input:focus {
      outline: none;
      border-color: var(--color-accent);
      background: var(--color-warm-white);
    }

    .modal-input.error {
      border-color: var(--color-danger);
      animation: shake 0.4s var(--ease-out);
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20%, 60% { transform: translateX(-6px); }
      40%, 80% { transform: translateX(6px); }
    }

    .modal-error {
      font-size: 12px;
      color: var(--color-danger);
      margin-top: 8px;
      display: none;
    }

    .modal-error.show {
      display: block;
    }

    .modal-btn {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, var(--color-brown) 0%, var(--color-deep) 100%);
      border: none;
      border-radius: var(--radius-md);
      color: var(--color-cream);
      font-family: var(--font-body);
      font-size: 14px;
      letter-spacing: 0.05em;
      cursor: pointer;
      transition: all 0.3s var(--ease-out);
    }

    .modal-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .modal-cancel {
      margin-top: 14px;
      background: none;
      border: none;
      color: var(--color-muted);
      font-family: var(--font-body);
      font-size: 13px;
      cursor: pointer;
      transition: color 0.3s;
      padding: 8px 16px;
    }

    .modal-cancel:hover {
      color: var(--color-medium);
    }

    /* Ê∑ªÂä†ÂºπÁ™ó */
    .modal-form-group {
      text-align: left;
      margin-bottom: 18px;
    }

    .modal-label {
      display: block;
      font-size: 12px;
      color: var(--color-brown);
      margin-bottom: 8px;
      font-weight: 500;
    }

    .icon-select {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .icon-btn {
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--color-cream);
      border: 2px solid transparent;
      border-radius: var(--radius-sm);
      font-size: 22px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .icon-btn:hover {
      background: rgba(196, 167, 125, 0.15);
    }

    .icon-btn.active {
      border-color: var(--color-accent);
      background: rgba(196, 167, 125, 0.1);
    }

    /* Toast */
    .toast-container {
      position: fixed;
      top: 60px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 3000;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: center;
    }

    .toast {
      padding: 12px 24px;
      background: var(--color-deep);
      color: var(--color-cream);
      border-radius: 100px;
      font-size: 13px;
      box-shadow: var(--shadow-xl);
      opacity: 0;
      transform: translateY(-10px);
      transition: all 0.3s var(--ease-out);
    }

    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }

    /* ÂøÉÂΩ¢Âä®Áîª */
    .heart-animation {
      position: fixed;
      pointer-events: none;
      z-index: 2500;
    }

    .floating-heart {
      position: absolute;
      font-size: 24px;
      animation: floatUp 1.2s var(--ease-out) forwards;
      opacity: 0;
    }

    @keyframes floatUp {
      0% { opacity: 1; transform: translateY(0) scale(1) rotate(0deg); }
      100% { opacity: 0; transform: translateY(-80px) scale(1.3) rotate(15deg); }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- ==================== Ê¨¢ËøéÈ°µ ==================== -->
    <div class="page active" id="welcomePage">
      <div class="welcome-page">
        <div class="welcome-brand">
          <div class="welcome-logo">
            <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
          </div>
          <h1 class="welcome-title">Êàë‰ª¨ÁöÑÊó•ËÆ∞Êú¨</h1>
          <p class="welcome-subtitle">ËÆ∞ÂΩïÁà±ÁöÑÁÇπÊª¥</p>
        </div>
        
        <div class="welcome-prompt">
          <h2>‰Ω†ÊòØË∞ÅÔºü</h2>
          <p>ÈÄâÊã©‰Ω†ÁöÑË∫´‰ªΩÂºÄÂßãËÆ∞ÂΩï</p>
        </div>
        
        <div class="identity-cards">
          <div class="identity-card cat" onclick="selectIdentity('cat')">
            <span class="identity-emoji">üê±</span>
            <div class="identity-name">ÂñµÂñµ</div>
            <div class="identity-hint">ÁÇπÂáªËøõÂÖ•</div>
          </div>
          <div class="identity-card dog" onclick="selectIdentity('dog')">
            <span class="identity-emoji">üê∂</span>
            <div class="identity-name">Â∞èÂùèËõã</div>
            <div class="identity-hint">ÁÇπÂáªËøõÂÖ•</div>
          </div>
        </div>
        
        <div class="stranger-link" onclick="showStrangerModal()">
          Êàë‰∏çÊòØ‰ªñ‰ª¨ÔºåÂè™ÊòØË∑ØËøá ‚Üí
        </div>
      </div>
    </div>

    <!-- ==================== È¶ñÈ°µ ==================== -->
    <div class="page" id="homePage">
      <div class="home-page">
        <header class="home-header">
          <div class="header-top">
            <div class="header-brand">
              <h1>Êàë‰ª¨ÁöÑÊó•ËÆ∞Êú¨</h1>
              <div class="couple-names">üê± ÂñµÂñµ ¬∑ üê∂ Â∞èÂùèËõã</div>
            </div>
            <div class="user-avatar" id="userAvatar" onclick="showMainPage('minePage')">üê±</div>
          </div>
        </header>

        <!-- Áä∂ÊÄÅÂç°Áâá -->
        <div class="home-status">
          <div class="status-card together-status">
            <div class="status-icon">üíï</div>
            <div class="status-info">
              <div class="status-number" id="homeDays">89</div>
              <div class="status-label">Âú®‰∏ÄËµ∑ÁöÑÊó•Â≠ê</div>
            </div>
          </div>
          <div class="status-card countdown-status" id="nextAnniversary">
            <div class="status-icon">üéÇ</div>
            <div class="status-info">
              <div class="status-number">27</div>
              <div class="status-label">Â§©Âêé ¬∑ ÂñµÂñµÁîüÊó•</div>
            </div>
          </div>
        </div>

        <!-- Êñ∞Âä®ÊÄÅ -->
        <div class="home-section" id="newUpdatesSection">
          <div class="section-header">
            <h2 class="section-title">üîî Êñ∞Âä®ÊÄÅ</h2>
          </div>
          <div class="updates-list" id="updatesList">
            <!-- Âä®ÊÄÅÂÜÖÂÆπÁî±JSÁîüÊàê -->
          </div>
        </div>

        <!-- ÂæÄÂπ¥‰ªäÊó• / ÈöèÊú∫ÂõûÂøÜ -->
        <div class="home-section" id="memorySection" style="display:none;">
          <div class="section-header">
            <h2 class="section-title">üìñ ÂõûÂøÜËÉ∂Âõä</h2>
            <button class="section-action" onclick="refreshMemory()">Êç¢‰∏ÄÁØá</button>
          </div>
          <div class="memory-card" id="memoryCard">
            <!-- ÂõûÂøÜÂÜÖÂÆπÁî±JSÁîüÊàê -->
          </div>
        </div>

        <!-- ÊêúÁ¥¢ÂíåÁ≠õÈÄâ -->
        <div class="home-section">
          <div class="section-header">
            <h2 class="section-title">üìù Êó•ËÆ∞Êú¨</h2>
          </div>
          <div class="search-bar">
            <svg class="search-icon" viewBox="0 0 24 24"><circle cx="11" cy="11" r="7"></circle><path d="M21 21l-4.35-4.35"></path></svg>
            <input type="text" class="search-input" placeholder="ÊêúÁ¥¢Êó•ËÆ∞..." id="searchInput" oninput="searchDiaries()">
          </div>
          <div class="filter-bar">
            <button class="filter-btn active" data-filter="all">ÂÖ®ÈÉ®</button>
            <button class="filter-btn" data-filter="cat">üê± ÂñµÂñµ</button>
            <button class="filter-btn" data-filter="dog">üê∂ Â∞èÂùèËõã</button>
            <button class="filter-btn" data-filter="together">üíë ‰∏ÄËµ∑</button>
          </div>
        </div>

        <div class="diary-list" id="diaryList">
          <!-- Êó•ËÆ∞Âç°ÁâáÁî±JSÂä®ÊÄÅÁîüÊàê -->
        </div>
      </div>
    </div>

    <!-- ==================== ÂÜôÊó•ËÆ∞È°µ ==================== -->
    <div class="page" id="writePage">
      <div class="write-page">
        <header class="write-header">
          <button class="header-btn btn-ghost" onclick="cancelWrite()">ÂèñÊ∂à</button>
          <h2>ÂÜôÊó•ËÆ∞</h2>
          <button class="header-btn btn-primary" onclick="saveDiary()" id="saveBtn">‰øùÂ≠ò</button>
        </header>

        <div class="write-form">
          <div class="form-section">
            <div class="form-label">üìÖ Êó•Êúü</div>
            <input type="date" class="form-input" id="diaryDate">
          </div>

          <div class="form-section">
            <div class="form-label">‚úçÔ∏è Ë∞ÅÊù•ÂÜô</div>
            <div class="select-group" id="authorSelect">
              <button class="select-btn active" data-author="cat">üê± ÂñµÂñµ</button>
              <button class="select-btn" data-author="dog">üê∂ Â∞èÂùèËõã</button>
              <button class="select-btn" data-author="together">üíë ‰∏ÄËµ∑</button>
            </div>
          </div>

          <div class="form-section">
            <div class="form-label">üí≠ ‰ªäÂ§©ÂøÉÊÉÖ</div>
            <div class="select-group" id="moodSelect">
              <button class="select-btn mood-btn active" data-mood="sunny">‚òÄÔ∏è</button>
              <button class="select-btn mood-btn" data-mood="cloudy">üå§</button>
              <button class="select-btn mood-btn" data-mood="rainy">üåß</button>
              <button class="select-btn mood-btn" data-mood="stormy">‚õà</button>
              <button class="select-btn mood-btn" data-mood="rainbow">üåà</button>
            </div>
          </div>

          <div class="form-section">
            <div class="form-label">üìù Ê†áÈ¢ò</div>
            <input type="text" class="form-input" id="diaryTitle" placeholder="Áªô‰ªäÂ§©Ëµ∑‰∏™Ê†áÈ¢ò">
          </div>

          <div class="form-section">
            <div class="form-label">‚ú® ‰ªäÂ§©ÁöÑÊïÖ‰∫ã</div>
            <textarea class="form-input form-textarea" id="diaryContent" placeholder="ÂÜô‰∏ã‰ªäÂ§©ÂèëÁîüÁöÑ‰∫ãÊÉÖ...&#10;ÔºàËá≥Â∞ë100Â≠óÂì¶ÔΩûÔºâ" oninput="updateCharCount()"></textarea>
            <div class="char-count" id="charCount">0/100Â≠ó</div>
          </div>

          <div class="form-section">
            <div class="form-label">üè∑Ô∏è Ê†áÁ≠æ</div>
            <div class="select-group" id="tagSelect">
              <button class="select-btn tag-btn" data-tag="Êó•Â∏∏">#Êó•Â∏∏</button>
              <button class="select-btn tag-btn" data-tag="Á∫¶‰ºö">#Á∫¶‰ºö</button>
              <button class="select-btn tag-btn" data-tag="ÊóÖË°å">#ÊóÖË°å</button>
              <button class="select-btn tag-btn" data-tag="ÁæéÈ£ü">#ÁæéÈ£ü</button>
              <button class="select-btn tag-btn" data-tag="Á∫™ÂøµÊó•">#Á∫™ÂøµÊó•</button>
              <button class="select-btn tag-btn" data-tag="Â∞èÁ°ÆÂπ∏">#Â∞èÁ°ÆÂπ∏</button>
              <button class="select-btn tag-btn" data-tag="ÂêµÊû∂ÂíåÂ•Ω">#ÂêµÊû∂ÂíåÂ•Ω</button>
              <button class="select-btn tag-btn" data-tag="Á¨¨‰∏ÄÊ¨°">#Á¨¨‰∏ÄÊ¨°</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ==================== ËØ¶ÊÉÖÈ°µ ==================== -->
    <div class="page" id="detailPage">
      <div class="detail-page">
        <header class="detail-header">
          <button class="back-btn" onclick="goBack()">
            <svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"></polyline></svg>
          </button>
          <div class="detail-actions">
            <button class="action-btn" onclick="editDiary()">
              <svg viewBox="0 0 24 24"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
            </button>
            <button class="action-btn" onclick="showDeleteModal()">
              <svg viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
            </button>
          </div>
        </header>

        <div class="detail-content" id="detailContent">
          <!-- ËØ¶ÊÉÖÂÜÖÂÆπÁî±JSÂä®ÊÄÅÁîüÊàê -->
        </div>
      </div>
    </div>

    <!-- ==================== Êó•ÂéÜÈ°µ ==================== -->
    <div class="page" id="calendarPage">
      <div class="calendar-page">
        <header class="calendar-header">
          <h1>Êó•ÂéÜ</h1>
          <p>ËÆ∞ÂΩïÊàë‰ª¨ÁöÑÊØè‰∏ÄÂ§©</p>
        </header>

        <div class="calendar-nav">
          <button class="calendar-nav-btn" onclick="prevMonth()">
            <svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"></polyline></svg>
          </button>
          <div class="calendar-month" id="calendarMonth">2024Âπ¥12Êúà</div>
          <button class="calendar-nav-btn" onclick="nextMonth()">
            <svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"></polyline></svg>
          </button>
        </div>

        <div class="calendar-grid">
          <div class="calendar-weekdays">
            <div class="weekday">Êó•</div>
            <div class="weekday">‰∏Ä</div>
            <div class="weekday">‰∫å</div>
            <div class="weekday">‰∏â</div>
            <div class="weekday">Âõõ</div>
            <div class="weekday">‰∫î</div>
            <div class="weekday">ÂÖ≠</div>
          </div>
          <div class="calendar-days" id="calendarDays">
            <!-- Êó•ÂéÜÊó•ÊúüÁî±JSÂä®ÊÄÅÁîüÊàê -->
          </div>
        </div>

        <div class="calendar-content" id="calendarContent">
          <!-- ÈÄâ‰∏≠Êó•ÊúüÁöÑÂÜÖÂÆπÁî±JSÂä®ÊÄÅÁîüÊàê -->
        </div>
      </div>
    </div>

    <!-- ==================== Á∫™ÂøµÊó•È°µ ==================== -->
    <div class="page" id="anniversaryPage">
      <div class="anniversary-page">
        <header class="anniversary-header">
          <h1>Á∫™ÂøµÊó•</h1>
          <p>ÈÇ£‰∫õÁâπÂà´ÁöÑÊó•Â≠ê</p>
        </header>

        <div class="anniversary-content">
          <div class="together-card">
            <div class="together-label">Êàë‰ª¨Âú®‰∏ÄËµ∑</div>
            <div class="together-days" id="togetherDays">89</div>
            <div class="together-unit">Â§©</div>
            <div class="together-date">‰ªé 2025-10-02 ÂºÄÂßã</div>
          </div>

          <div class="anniversary-list" id="anniversaryList">
            <!-- Á∫™ÂøµÊó•ÂàóË°®Áî±JSÂä®ÊÄÅÁîüÊàê -->
          </div>

          <button class="add-anniversary-btn" onclick="showAddAnniversaryModal()">
            <span>‚ûï</span> Ê∑ªÂä†Á∫™ÂøµÊó•
          </button>
        </div>
      </div>
    </div>

    <!-- ==================== ÊàëÁöÑÈ°µÈù¢ ==================== -->
    <div class="page" id="minePage">
      <div class="mine-page">
        <header class="mine-header">
          <div class="mine-avatars">
            <div class="mine-avatar">üê±</div>
            <div class="mine-heart">üíï</div>
            <div class="mine-avatar">üê∂</div>
          </div>
          <div class="mine-names">ÂñµÂñµ & Â∞èÂùèËõã</div>
          <div class="mine-days">Âú®‰∏ÄËµ∑ <span id="mineDays">89</span> Â§©</div>
          <div class="mine-current">ÂΩìÂâçË∫´‰ªΩÔºö<span id="currentRole">üê± ÂñµÂñµ</span></div>
        </header>

        <div class="mine-stats">
          <div class="mine-stat">
            <div class="mine-stat-number" id="statDiaries">0</div>
            <div class="mine-stat-label">ÁØáÊó•ËÆ∞</div>
          </div>
          <div class="mine-stat">
            <div class="mine-stat-number" id="statComments">0</div>
            <div class="mine-stat-label">Êù°‰∫íÂä®</div>
          </div>
          <div class="mine-stat">
            <div class="mine-stat-number" id="statAnniversaries">0</div>
            <div class="mine-stat-label">‰∏™Á∫™ÂøµÊó•</div>
          </div>
        </div>

        <div class="mine-menu">
          <div class="mine-menu-item" onclick="switchRole()">
            <div class="mine-menu-icon">üîÑ</div>
            <div class="mine-menu-text">ÂàáÊç¢Ë∫´‰ªΩ</div>
            <div class="mine-menu-arrow">‚Ä∫</div>
          </div>
          <div class="mine-menu-item" onclick="showResetPasswordModal()">
            <div class="mine-menu-icon">üîê</div>
            <div class="mine-menu-text">‰øÆÊîπÂØÜÁ†Å</div>
            <div class="mine-menu-arrow">‚Ä∫</div>
          </div>
          <div class="mine-menu-item" onclick="exportData()">
            <div class="mine-menu-icon">üì§</div>
            <div class="mine-menu-text">ÂØºÂá∫Êï∞ÊçÆ</div>
            <div class="mine-menu-arrow">‚Ä∫</div>
          </div>
          <div class="mine-menu-item" onclick="showAboutModal()">
            <div class="mine-menu-icon">üíù</div>
            <div class="mine-menu-text">ÂÖ≥‰∫éÊàë‰ª¨</div>
            <div class="mine-menu-arrow">‚Ä∫</div>
          </div>
          <div class="mine-menu-item" onclick="logout()">
            <div class="mine-menu-icon">üëã</div>
            <div class="mine-menu-text">ÈÄÄÂá∫ÁôªÂΩï</div>
            <div class="mine-menu-arrow">‚Ä∫</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Â∫ïÈÉ®ÂØºËà™ -->
    <nav class="tab-bar" id="tabBar">
      <button class="tab-item active" data-page="homePage">
        <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
        <span>È¶ñÈ°µ</span>
      </button>
      <button class="tab-item" data-page="calendarPage">
        <svg viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
        <span>Êó•ÂéÜ</span>
      </button>
      <button class="tab-item center" data-page="writePage">
        <div class="tab-icon-wrap">
          <svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
        </div>
      </button>
      <button class="tab-item" data-page="anniversaryPage">
        <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path></svg>
        <span>Á∫™ÂøµÊó•</span>
      </button>
      <button class="tab-item" data-page="minePage">
        <svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
        <span>ÊàëÁöÑ</span>
      </button>
    </nav>
  </div>

  <!-- ==================== ÂºπÁ™ó ==================== -->
  <!-- ÂØÜÁ†ÅÂºπÁ™ó -->
  <div class="modal-overlay" id="passwordModal">
    <div class="modal">
      <div class="modal-icon" id="modalIcon">üê±</div>
      <h3 class="modal-title" id="modalTitle">ÂñµÂñµÔºåËØ∑ËæìÂÖ•ÂØÜÁ†Å</h3>
      <p class="modal-subtitle" id="modalSubtitle">ËæìÂÖ•‰Ω†ÁöÑ‰∏ìÂ±ûÂØÜÁ†ÅËøõÂÖ•Êó•ËÆ∞Êú¨</p>
      <div class="modal-input-wrap">
        <input type="password" class="modal-input" id="passwordInput" maxlength="20" placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å">
        <div class="modal-error" id="passwordError">ÂØÜÁ†Å‰∏çÂØπÂì¶</div>
      </div>
      <button class="modal-btn" id="confirmBtn" onclick="confirmPassword()">Á°ÆËÆ§ËøõÂÖ•</button>
      <button class="modal-cancel" id="forgotPassword" onclick="forgotPassword()">ÂøòËÆ∞ÂØÜÁ†ÅÔºü</button>
      <button class="modal-cancel" onclick="closeModal()">ËøîÂõû</button>
    </div>
  </div>

  <!-- ÂøòËÆ∞ÂØÜÁ†ÅÂºπÁ™ó -->
  <div class="modal-overlay" id="resetModal">
    <div class="modal">
      <div class="modal-icon">üîê</div>
      <h3 class="modal-title" id="resetTitle">ÈáçÁΩÆÂØÜÁ†Å</h3>
      <p class="modal-subtitle">ËØ∑ËæìÂÖ•‰Ω†‰ª¨Âú®‰∏ÄËµ∑ÁöÑÊó•ÊúüÈ™åËØÅË∫´‰ªΩ</p>
      <div class="modal-input-wrap">
        <input type="date" class="modal-input" id="resetDateInput" style="letter-spacing: 0;">
        <div class="modal-error" id="resetError">Êó•Êúü‰∏çÂØπÂì¶</div>
      </div>
      <button class="modal-btn" onclick="confirmResetDate()">È™åËØÅ</button>
      <button class="modal-cancel" onclick="closeResetModal()">ËøîÂõû</button>
    </div>
  </div>

  <!-- ËÆæÁΩÆÊñ∞ÂØÜÁ†ÅÂºπÁ™ó -->
  <div class="modal-overlay" id="newPasswordModal">
    <div class="modal">
      <div class="modal-icon" id="newPwdIcon">üîë</div>
      <h3 class="modal-title" id="newPwdTitle">ËÆæÁΩÆÊñ∞ÂØÜÁ†Å</h3>
      <p class="modal-subtitle" id="newPwdSubtitle">ËØ∑ËæìÂÖ•Ëá≥Â∞ë8‰ΩçÁöÑÊñ∞ÂØÜÁ†Å</p>
      <div class="modal-input-wrap">
        <input type="password" class="modal-input" id="newPasswordInput" maxlength="20" placeholder="ËØ∑ËæìÂÖ•Êñ∞ÂØÜÁ†Å">
        <div class="modal-error" id="newPwdError">ÈîôËØØ</div>
      </div>
      <button class="modal-btn" id="newPwdBtn" onclick="confirmNewPassword()">Á°ÆËÆ§</button>
      <button class="modal-cancel" onclick="closeNewPasswordModal()">ÂèñÊ∂à</button>
    </div>
  </div>

  <!-- Âà†Èô§Á°ÆËÆ§ÂºπÁ™ó -->
  <div class="modal-overlay" id="deleteModal">
    <div class="modal">
      <div class="modal-icon" id="deleteIcon">üîê</div>
      <h3 class="modal-title" id="deleteTitle">ËØ∑ÂñµÂñµËæìÂÖ•ÂØÜÁ†Å</h3>
      <p class="modal-subtitle" id="deleteSubtitle">Âà†Èô§ÈúÄË¶Å‰∏§‰∫∫Á°ÆËÆ§</p>
      <div class="modal-input-wrap">
        <input type="password" class="modal-input" id="deletePasswordInput" maxlength="20" placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å">
        <div class="modal-error" id="deletePasswordError">ÂØÜÁ†Å‰∏çÂØπÂì¶</div>
      </div>
      <button class="modal-btn" onclick="confirmDelete()">Á°ÆËÆ§</button>
      <button class="modal-cancel" onclick="closeDeleteModal()">ÂèñÊ∂àÂà†Èô§</button>
    </div>
  </div>

  <!-- ÈôåÁîü‰∫∫ÂºπÁ™ó -->
  <div class="modal-overlay" id="strangerModal">
    <div class="modal">
      <div class="modal-icon">üö™</div>
      <h3 class="modal-title">ËøôÈáåÊòØÁßÅ‰∫∫Á©∫Èó¥Âì¶ÔΩû</h3>
      <p class="modal-subtitle">
        ËøôÊòØÂñµÂñµÂíåÂ∞èÂùèËõãÁöÑÁßòÂØÜÊó•ËÆ∞Êú¨<br><br>
        Â¶ÇÊûú‰Ω†‰∏çÂ∞èÂøÉÈóØËøõÊù•‰∫Ü<br>
        ËØ∑ÊÇÑÊÇÑÈÄÄÂá∫ÔºåÂÅáË£Ö‰ªÄ‰πàÈÉΩÊ≤°ÁúãÂà∞ ü§´<br><br>
        <span style="font-size:11px;opacity:0.7;">Á•ù‰Ω†‰πüËÉΩÊâæÂà∞Â±û‰∫éËá™Â∑±ÁöÑÈÇ£‰∏™‰∫∫ üíï</span>
      </p>
      <button class="modal-btn" onclick="closeStrangerModal()">Â•ΩÁöÑÔºåÊàëÊÇÑÊÇÑÁ¶ªÂºÄ</button>
    </div>
  </div>

  <!-- Ê∑ªÂä†Á∫™ÂøµÊó•ÂºπÁ™ó -->
  <div class="modal-overlay" id="addAnniversaryModal">
    <div class="modal">
      <div class="modal-icon">üíù</div>
      <h3 class="modal-title">Ê∑ªÂä†Á∫™ÂøµÊó•</h3>
      <p class="modal-subtitle">ËÆ∞ÂΩïÈÇ£‰∫õÈáçË¶ÅÁöÑÊó•Â≠ê</p>
      <div class="modal-form-group">
        <label class="modal-label">ÂêçÁß∞</label>
        <input type="text" class="modal-input" id="anniversaryName" placeholder="Â¶ÇÔºöÂñµÂñµÁîüÊó•" style="text-align:left;letter-spacing:0;">
      </div>
      <div class="modal-form-group">
        <label class="modal-label">Êó•Êúü</label>
        <input type="date" class="modal-input" id="anniversaryDate" style="letter-spacing:0;">
      </div>
      <div class="modal-form-group">
        <label class="modal-label">ÂõæÊ†á</label>
        <div class="icon-select" id="iconSelect">
          <button class="icon-btn active" data-icon="üíï">üíï</button>
          <button class="icon-btn" data-icon="üéÇ">üéÇ</button>
          <button class="icon-btn" data-icon="üíù">üíù</button>
          <button class="icon-btn" data-icon="üåô">üåô</button>
          <button class="icon-btn" data-icon="‚úàÔ∏è">‚úàÔ∏è</button>
          <button class="icon-btn" data-icon="üéâ">üéâ</button>
          <button class="icon-btn" data-icon="üíç">üíç</button>
          <button class="icon-btn" data-icon="üè†">üè†</button>
        </div>
      </div>
      <button class="modal-btn" onclick="addAnniversary()">Ê∑ªÂä†</button>
      <button class="modal-cancel" onclick="closeAddAnniversaryModal()">ÂèñÊ∂à</button>
    </div>
  </div>

  <!-- Ê∑ªÂä†‰∫ãÈ°πÂºπÁ™ó -->
  <div class="modal-overlay" id="addEventModal">
    <div class="modal">
      <div class="modal-icon">üìå</div>
      <h3 class="modal-title">Ê∑ªÂä†ÈáçË¶Å‰∫ãÈ°π</h3>
      <p class="modal-subtitle" id="eventDateText">2024Âπ¥12Êúà29Êó•</p>
      <div class="modal-form-group">
        <label class="modal-label">‰∫ãÈ°πÂÜÖÂÆπ</label>
        <input type="text" class="modal-input" id="eventContent" placeholder="Â¶ÇÔºöÂáÜÂ§áÁ§ºÁâ©" style="text-align:left;letter-spacing:0;">
      </div>
      <button class="modal-btn" onclick="addEvent()">Ê∑ªÂä†</button>
      <button class="modal-cancel" onclick="closeAddEventModal()">ÂèñÊ∂à</button>
    </div>
  </div>

  <!-- ÂÖ≥‰∫éÂºπÁ™ó -->
  <div class="modal-overlay" id="aboutModal">
    <div class="modal">
      <div class="modal-icon">üíï</div>
      <h3 class="modal-title">Êàë‰ª¨ÁöÑÊó•ËÆ∞Êú¨</h3>
      <p class="modal-subtitle">
        ËøôÊòØÂ±û‰∫éÂñµÂñµÂíåÂ∞èÂùèËõãÁöÑÁßòÂØÜÁ©∫Èó¥<br><br>
        ËÆ∞ÂΩïÊØè‰∏Ä‰∏™Âπ≥Âá°ÂèàÁâπÂà´ÁöÑÊó•Â≠ê<br>
        ÊØè‰∏ÄÊ¨°ÂøÉÂä®ÔºåÊØè‰∏ÄÊ¨°ÊÑüÂä®<br><br>
        ÊÑøÊàë‰ª¨ÁöÑÁà±ÊÉÖÔºåÁªÜÊ∞¥ÈïøÊµÅ ‚ú®
      </p>
      <button class="modal-btn" onclick="closeAboutModal()">Â•ΩÁöÑ</button>
    </div>
  </div>

  <div class="toast-container" id="toastContainer"></div>
  <div class="heart-animation" id="heartAnimation"></div>

  <script>
    // ==================== ÈÖçÁΩÆ ====================
    const CONFIG = {
      togetherDate: '2025-10-02',
      names: { cat: 'ÂñµÂñµ', dog: 'Â∞èÂùèËõã' },
      emojis: { cat: 'üê±', dog: 'üê∂' },
      moods: { sunny: '‚òÄÔ∏è', cloudy: 'üå§', rainy: 'üåß', stormy: '‚õà', rainbow: 'üåà' }
    };

    // ==================== Áä∂ÊÄÅ ====================
    let state = {
      currentRole: null,
      currentPage: 'welcomePage',
      diaries: [],
      anniversaries: [],
      events: [],
      currentDiaryId: null,
      currentFilter: 'all',
      calendarYear: new Date().getFullYear(),
      calendarMonth: new Date().getMonth(),
      selectedDate: null,
      isSettingPassword: false,
      firstPassword: '',
      deleteStep: 1,
      deleteType: null,
      deleteId: null
    };

    // ==================== ÂàùÂßãÂåñ ====================
    function init() {
      loadData();
      updateDaysCount();
      
      const savedRole = localStorage.getItem('userRole');
      if (savedRole && hasPassword(savedRole)) {
        state.currentRole = savedRole;
        showPage('homePage');
        updateUserAvatar();
      }
      
      initEventListeners();
      renderDiaryList();
      renderUpdates();
      renderMemory();
      renderNextAnniversary();
      renderCalendar();
      renderAnniversaries();
      updateStats();
    }

    // ==================== È¶ñÈ°µÂàÜÂå∫ÂäüËÉΩ ====================
    function updateUserAvatar() {
      document.getElementById('userAvatar').textContent = CONFIG.emojis[state.currentRole];
    }

    function renderNextAnniversary() {
      const today = new Date();
      let nearest = null;
      let minDays = Infinity;

      state.anniversaries.forEach(a => {
        const aDate = new Date(a.date);
        let nextDate = new Date(today.getFullYear(), aDate.getMonth(), aDate.getDate());
        if (nextDate <= today) {
          nextDate = new Date(today.getFullYear() + 1, aDate.getMonth(), aDate.getDate());
        }
        const daysLeft = Math.ceil((nextDate - today) / (1000 * 60 * 60 * 24));
        if (daysLeft < minDays && daysLeft > 0) {
          minDays = daysLeft;
          nearest = { ...a, daysLeft };
        }
      });

      const container = document.getElementById('nextAnniversary');
      if (nearest) {
        container.innerHTML = `
          <div class="status-icon">${nearest.icon}</div>
          <div class="status-info">
            <div class="status-number">${nearest.daysLeft}</div>
            <div class="status-label">Â§©Âêé ¬∑ ${nearest.name}</div>
          </div>
        `;
      } else {
        container.innerHTML = `
          <div class="status-icon">üìÖ</div>
          <div class="status-info">
            <div class="status-number">--</div>
            <div class="status-label">ÊöÇÊó†Á∫™ÂøµÊó•</div>
          </div>
        `;
      }
    }

    function renderUpdates() {
      const container = document.getElementById('updatesList');
      const section = document.getElementById('newUpdatesSection');
      const otherRole = state.currentRole === 'cat' ? 'dog' : 'cat';
      
      // Ëé∑ÂèñÂØπÊñπÁöÑÊúÄÊñ∞Êó•ËÆ∞Âíå‰∫íÂä®
      const updates = [];
      
      // ÂØπÊñπÊúÄËøëÂÜôÁöÑÊó•ËÆ∞
      const otherDiaries = state.diaries
        .filter(d => d.author === otherRole || d.author === 'together')
        .sort((a, b) => new Date(b.createdAt || b.date) - new Date(a.createdAt || a.date))
        .slice(0, 2);
      
      otherDiaries.forEach(d => {
        const isRecent = (Date.now() - new Date(d.createdAt || d.date).getTime()) < 7 * 24 * 60 * 60 * 1000;
        updates.push({
          type: 'diary',
          id: d.id,
          avatar: d.author === 'together' ? 'üíë' : CONFIG.emojis[d.author],
          text: `<strong>${d.author === 'together' ? '‰Ω†‰ª¨' : CONFIG.names[otherRole]}</strong> ÂÜô‰∫ÜÊñ∞Êó•ËÆ∞„Äå${d.title}„Äç`,
          time: formatTime(d.createdAt || d.date),
          unread: isRecent
        });
      });

      // ÂØπÊñπÊúÄËøëÁöÑ‰∫íÂä®ËØÑËÆ∫
      state.diaries.forEach(d => {
        if (d.author === state.currentRole && d.comments) {
          const recentComments = d.comments
            .filter(c => c.author === otherRole)
            .slice(-2);
          
          recentComments.forEach(c => {
            updates.push({
              type: 'comment',
              id: d.id,
              avatar: CONFIG.emojis[otherRole],
              text: c.type === 'action' 
                ? `<strong>${CONFIG.names[otherRole]}</strong> ÂØπ‰Ω† ${c.content}`
                : `<strong>${CONFIG.names[otherRole]}</strong> ÂõûÂ§ç‰∫Ü‰Ω†ÁöÑÊó•ËÆ∞`,
              time: c.time || 'ÂàöÂàö',
              unread: true
            });
          });
        }
      });

      if (updates.length === 0) {
        container.innerHTML = `<div class="no-updates">ÊöÇÊó∂Ê≤°ÊúâÊñ∞Âä®ÊÄÅÔºåÂéªÂÜô‰∏ÄÁØáÊó•ËÆ∞ÂêßÔΩû</div>`;
      } else {
        container.innerHTML = updates.slice(0, 4).map(u => `
          <div class="update-item ${u.unread ? 'unread' : ''}" onclick="showDiaryDetail('${u.id}')">
            <div class="update-avatar">${u.avatar}</div>
            <div class="update-content">
              <div class="update-text">${u.text}</div>
              <div class="update-time">${u.time}</div>
            </div>
            ${u.unread ? '<div class="update-badge"></div>' : ''}
          </div>
        `).join('');
      }
    }

    function renderMemory() {
      const container = document.getElementById('memoryCard');
      const section = document.getElementById('memorySection');
      
      if (state.diaries.length < 3) {
        section.style.display = 'none';
        return;
      }

      section.style.display = 'block';
      
      const today = new Date();
      
      // ‰ºòÂÖàÊâæÂæÄÂπ¥‰ªäÊó•
      let memory = state.diaries.find(d => {
        const dDate = new Date(d.date);
        return dDate.getMonth() === today.getMonth() && 
               dDate.getDate() === today.getDate() &&
               dDate.getFullYear() < today.getFullYear();
      });

      // Ê≤°ÊúâÂæÄÂπ¥‰ªäÊó•Â∞±ÈöèÊú∫ÈÄâ‰∏ÄÁØá
      if (!memory) {
        const oldDiaries = state.diaries.filter(d => {
          return (Date.now() - new Date(d.date).getTime()) > 7 * 24 * 60 * 60 * 1000;
        });
        if (oldDiaries.length > 0) {
          memory = oldDiaries[Math.floor(Math.random() * oldDiaries.length)];
        }
      }

      if (!memory) {
        section.style.display = 'none';
        return;
      }

      const date = new Date(memory.date);
      const isThisDay = date.getMonth() === today.getMonth() && date.getDate() === today.getDate();
      const yearDiff = today.getFullYear() - date.getFullYear();
      const tagText = isThisDay ? `${yearDiff}Âπ¥ÂâçÁöÑ‰ªäÂ§©` : 'ÈöèÊú∫ÂõûÂøÜ';
      const authorText = memory.author === 'cat' ? 'üê± ÂñµÂñµ' : memory.author === 'dog' ? 'üê∂ Â∞èÂùèËõã' : 'üíë ‰∏ÄËµ∑';

      container.innerHTML = `
        <div class="memory-header">
          <span class="memory-tag">${tagText}</span>
          <span class="memory-date">${date.getFullYear()}.${date.getMonth() + 1}.${date.getDate()}</span>
        </div>
        <div class="memory-title">${memory.title}</div>
        <div class="memory-preview">${memory.content}</div>
        <div class="memory-footer">
          <span class="memory-author">${authorText} ¬∑ ${CONFIG.moods[memory.mood]}</span>
        </div>
      `;

      container.onclick = () => showDiaryDetail(memory.id);
    }

    function refreshMemory() {
      // ÈöèÊú∫ÈÄâ‰∏ÄÁØá
      const oldDiaries = state.diaries.filter(d => {
        return (Date.now() - new Date(d.date).getTime()) > 3 * 24 * 60 * 60 * 1000;
      });
      
      if (oldDiaries.length === 0) return;
      
      const memory = oldDiaries[Math.floor(Math.random() * oldDiaries.length)];
      const container = document.getElementById('memoryCard');
      const date = new Date(memory.date);
      const authorText = memory.author === 'cat' ? 'üê± ÂñµÂñµ' : memory.author === 'dog' ? 'üê∂ Â∞èÂùèËõã' : 'üíë ‰∏ÄËµ∑';

      container.innerHTML = `
        <div class="memory-header">
          <span class="memory-tag">ÈöèÊú∫ÂõûÂøÜ</span>
          <span class="memory-date">${date.getFullYear()}.${date.getMonth() + 1}.${date.getDate()}</span>
        </div>
        <div class="memory-title">${memory.title}</div>
        <div class="memory-preview">${memory.content}</div>
        <div class="memory-footer">
          <span class="memory-author">${authorText} ¬∑ ${CONFIG.moods[memory.mood]}</span>
        </div>
      `;

      container.onclick = () => showDiaryDetail(memory.id);
      showToast('Êç¢‰∫Ü‰∏ÄÁØáÂõûÂøÜ ‚ú®');
    }

    function formatTime(dateStr) {
      const date = new Date(dateStr);
      const now = new Date();
      const diff = now - date;
      
      if (diff < 60 * 60 * 1000) return 'ÂàöÂàö';
      if (diff < 24 * 60 * 60 * 1000) return Math.floor(diff / (60 * 60 * 1000)) + 'Â∞èÊó∂Ââç';
      if (diff < 7 * 24 * 60 * 60 * 1000) return Math.floor(diff / (24 * 60 * 60 * 1000)) + 'Â§©Ââç';
      return `${date.getMonth() + 1}Êúà${date.getDate()}Êó•`;
    }

    function loadData() {
      state.diaries = JSON.parse(localStorage.getItem('diaries') || '[]');
      state.anniversaries = JSON.parse(localStorage.getItem('anniversaries') || '[]');
      state.events = JSON.parse(localStorage.getItem('events') || '[]');
      
      // Ê∑ªÂä†ÈªòËÆ§Á∫™ÂøµÊó•
      if (state.anniversaries.length === 0) {
        state.anniversaries = [
          { id: 1, name: 'Âú®‰∏ÄËµ∑Á∫™ÂøµÊó•', date: CONFIG.togetherDate, icon: 'üíï' },
          { id: 2, name: 'ÂñµÂñµÁîüÊó•', date: '2025-01-26', icon: 'üéÇ' },
          { id: 3, name: 'Â∞èÂùèËõãÁîüÊó•', date: '2025-06-15', icon: 'üéÇ' }
        ];
        saveData();
      }
    }

    function saveData() {
      localStorage.setItem('diaries', JSON.stringify(state.diaries));
      localStorage.setItem('anniversaries', JSON.stringify(state.anniversaries));
      localStorage.setItem('events', JSON.stringify(state.events));
    }

    function initEventListeners() {
      // Â∫ïÈÉ®ÂØºËà™
      document.querySelectorAll('.tab-item').forEach(btn => {
        btn.addEventListener('click', function() {
          const page = this.dataset.page;
          if (page === 'writePage') {
            resetWriteForm();
          }
          showMainPage(page);
        });
      });

      // Á≠õÈÄâÊåâÈíÆ
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          state.currentFilter = this.dataset.filter;
          renderDiaryList();
        });
      });

      // ÂÜôÊó•ËÆ∞ - ‰ΩúËÄÖÈÄâÊã©
      document.querySelectorAll('#authorSelect .select-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('#authorSelect .select-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
        });
      });

      // ÂÜôÊó•ËÆ∞ - ÂøÉÊÉÖÈÄâÊã©
      document.querySelectorAll('#moodSelect .select-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('#moodSelect .select-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
        });
      });

      // ÂÜôÊó•ËÆ∞ - Ê†áÁ≠æÈÄâÊã©ÔºàÂ§öÈÄâÔºâ
      document.querySelectorAll('#tagSelect .select-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          this.classList.toggle('active');
        });
      });

      // Á∫™ÂøµÊó•ÂõæÊ†áÈÄâÊã©
      document.querySelectorAll('#iconSelect .icon-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('#iconSelect .icon-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
        });
      });

      // ÂõûËΩ¶Á°ÆËÆ§
      document.getElementById('passwordInput').addEventListener('keyup', e => {
        if (e.key === 'Enter') confirmPassword();
      });
      document.getElementById('deletePasswordInput').addEventListener('keyup', e => {
        if (e.key === 'Enter') confirmDelete();
      });
      document.getElementById('newPasswordInput').addEventListener('keyup', e => {
        if (e.key === 'Enter') confirmNewPassword();
      });
    }

    // ==================== È°µÈù¢ÂØºËà™ ====================
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(pageId).classList.add('active');
      state.currentPage = pageId;
      
      // ÊòæÁ§∫/ÈöêËóèÂ∫ïÈÉ®ÂØºËà™
      const tabBar = document.getElementById('tabBar');
      if (['welcomePage', 'writePage', 'detailPage'].includes(pageId)) {
        tabBar.style.display = 'none';
      } else {
        tabBar.style.display = 'flex';
      }
    }

    function showMainPage(pageId) {
      showPage(pageId);
      
      // Êõ¥Êñ∞ÂØºËà™È´ò‰∫Æ
      document.querySelectorAll('.tab-item').forEach(item => {
        item.classList.remove('active');
        if (item.dataset.page === pageId) {
          item.classList.add('active');
        }
      });

      // È°µÈù¢ÁâπÂÆöÊõ¥Êñ∞
      if (pageId === 'homePage') {
        renderUpdates();
        renderMemory();
        renderNextAnniversary();
        renderDiaryList();
        updateUserAvatar();
      } else if (pageId === 'calendarPage') {
        renderCalendar();
      } else if (pageId === 'anniversaryPage') {
        renderAnniversaries();
      } else if (pageId === 'minePage') {
        updateMinePageInfo();
      }
    }

    function goBack() {
      showMainPage('homePage');
    }

    // ==================== ÂØÜÁ†ÅÁõ∏ÂÖ≥ ====================
    function getPasswords() {
      return JSON.parse(localStorage.getItem('passwords') || '{}');
    }

    function savePassword(role, password) {
      const passwords = getPasswords();
      passwords[role] = password;
      localStorage.setItem('passwords', JSON.stringify(passwords));
    }

    function hasPassword(role) {
      return !!getPasswords()[role];
    }

    function selectIdentity(role) {
      state.currentRole = role;
      state.isSettingPassword = false;
      state.firstPassword = '';
      
      if (hasPassword(role)) {
        showLoginModal(role);
      } else {
        showSetPasswordModal(role);
      }
    }

    function showLoginModal(role) {
      state.isSettingPassword = false;
      document.getElementById('modalIcon').textContent = CONFIG.emojis[role];
      document.getElementById('modalTitle').textContent = CONFIG.names[role] + 'ÔºåËØ∑ËæìÂÖ•ÂØÜÁ†Å';
      document.getElementById('modalSubtitle').textContent = 'ËæìÂÖ•‰Ω†ÁöÑ‰∏ìÂ±ûÂØÜÁ†ÅËøõÂÖ•Êó•ËÆ∞Êú¨';
      document.getElementById('confirmBtn').textContent = 'Á°ÆËÆ§ËøõÂÖ•';
      document.getElementById('forgotPassword').style.display = 'block';
      document.getElementById('passwordInput').value = '';
      document.getElementById('passwordInput').type = 'password';
      clearError('passwordError', 'passwordInput');
      document.getElementById('passwordModal').classList.add('active');
      setTimeout(() => document.getElementById('passwordInput').focus(), 300);
    }

    function showSetPasswordModal(role) {
      state.isSettingPassword = true;
      state.firstPassword = '';
      document.getElementById('modalIcon').textContent = CONFIG.emojis[role];
      document.getElementById('modalTitle').textContent = CONFIG.names[role] + 'ÔºåËÆæÁΩÆ‰∏ìÂ±ûÂØÜÁ†Å';
      document.getElementById('modalSubtitle').textContent = 'ËØ∑ËÆæÁΩÆËá≥Â∞ë8‰ΩçÂØÜÁ†Å';
      document.getElementById('confirmBtn').textContent = '‰∏ã‰∏ÄÊ≠•';
      document.getElementById('forgotPassword').style.display = 'none';
      document.getElementById('passwordInput').value = '';
      clearError('passwordError', 'passwordInput');
      document.getElementById('passwordModal').classList.add('active');
      setTimeout(() => document.getElementById('passwordInput').focus(), 300);
    }

    function closeModal() {
      document.getElementById('passwordModal').classList.remove('active');
    }

    function confirmPassword() {
      const password = document.getElementById('passwordInput').value;

      if (state.isSettingPassword) {
        if (state.firstPassword === '') {
          if (password.length < 8) {
            showError('passwordError', 'passwordInput', 'ÂØÜÁ†ÅËá≥Â∞ëÈúÄË¶Å8‰ΩçÂì¶');
            return;
          }
          state.firstPassword = password;
          document.getElementById('modalTitle').textContent = 'ÂÜçËæìÂÖ•‰∏ÄÊ¨°Á°ÆËÆ§';
          document.getElementById('modalSubtitle').textContent = 'ËØ∑ÂÜçÊ¨°ËæìÂÖ•Áõ∏ÂêåÁöÑÂØÜÁ†Å';
          document.getElementById('confirmBtn').textContent = 'Á°ÆËÆ§ËÆæÁΩÆ';
          document.getElementById('passwordInput').value = '';
        } else {
          if (password === state.firstPassword) {
            savePassword(state.currentRole, password);
            localStorage.setItem('userRole', state.currentRole);
            closeModal();
            showMainPage('homePage');
            showToast('ÂØÜÁ†ÅËÆæÁΩÆÊàêÂäü ‚ú® Ê¨¢Ëøé‰Ω†Ôºå' + CONFIG.names[state.currentRole]);
            updateUserAvatar();
          } else {
            showError('passwordError', 'passwordInput', '‰∏§Ê¨°ÂØÜÁ†Å‰∏ç‰∏ÄËá¥');
            state.firstPassword = '';
            document.getElementById('modalTitle').textContent = CONFIG.names[state.currentRole] + 'ÔºåËÆæÁΩÆ‰∏ìÂ±ûÂØÜÁ†Å';
            document.getElementById('modalSubtitle').textContent = 'ËØ∑ËÆæÁΩÆËá≥Â∞ë8‰ΩçÂØÜÁ†Å';
            document.getElementById('confirmBtn').textContent = '‰∏ã‰∏ÄÊ≠•';
          }
        }
      } else {
        const passwords = getPasswords();
        if (password === passwords[state.currentRole]) {
          localStorage.setItem('userRole', state.currentRole);
          closeModal();
          showMainPage('homePage');
          showToast('Ê¨¢ËøéÂõûÊù•Ôºå' + CONFIG.names[state.currentRole] + ' üíï');
        } else {
          showError('passwordError', 'passwordInput', 'ÂØÜÁ†Å‰∏çÂØπÂì¶ÔºåÂÜçËØïËØïÔºü');
        }
      }
    }

    function forgotPassword() {
      closeModal();
      document.getElementById('resetDateInput').value = '';
      clearError('resetError', 'resetDateInput');
      document.getElementById('resetModal').classList.add('active');
    }

    function closeResetModal() {
      document.getElementById('resetModal').classList.remove('active');
      showLoginModal(state.currentRole);
    }

    function confirmResetDate() {
      const inputDate = document.getElementById('resetDateInput').value;
      if (inputDate === CONFIG.togetherDate) {
        document.getElementById('resetModal').classList.remove('active');
        showNewPasswordModal();
      } else {
        showError('resetError', 'resetDateInput', 'Êó•Êúü‰∏çÂØπÂì¶ÔºåÊÉ≥ÊÉ≥‰Ω†‰ª¨ÊòØÂì™Â§©Âú®‰∏ÄËµ∑ÁöÑÔºüüí≠');
      }
    }

    function showNewPasswordModal() {
      state.firstPassword = '';
      document.getElementById('newPwdIcon').textContent = CONFIG.emojis[state.currentRole];
      document.getElementById('newPwdTitle').textContent = CONFIG.names[state.currentRole] + 'ÔºåËÆæÁΩÆÊñ∞ÂØÜÁ†Å';
      document.getElementById('newPwdSubtitle').textContent = 'ËØ∑ËæìÂÖ•Ëá≥Â∞ë8‰ΩçÁöÑÊñ∞ÂØÜÁ†Å';
      document.getElementById('newPwdBtn').textContent = '‰∏ã‰∏ÄÊ≠•';
      document.getElementById('newPasswordInput').value = '';
      clearError('newPwdError', 'newPasswordInput');
      document.getElementById('newPasswordModal').classList.add('active');
      setTimeout(() => document.getElementById('newPasswordInput').focus(), 300);
    }

    function closeNewPasswordModal() {
      document.getElementById('newPasswordModal').classList.remove('active');
    }

    function confirmNewPassword() {
      const password = document.getElementById('newPasswordInput').value;

      if (state.firstPassword === '') {
        if (password.length < 8) {
          showError('newPwdError', 'newPasswordInput', 'ÂØÜÁ†ÅËá≥Â∞ëÈúÄË¶Å8‰ΩçÂì¶');
          return;
        }
        state.firstPassword = password;
        document.getElementById('newPwdTitle').textContent = 'ÂÜçËæìÂÖ•‰∏ÄÊ¨°Á°ÆËÆ§';
        document.getElementById('newPwdSubtitle').textContent = 'ËØ∑ÂÜçÊ¨°ËæìÂÖ•Áõ∏ÂêåÁöÑÂØÜÁ†Å';
        document.getElementById('newPwdBtn').textContent = 'Á°ÆËÆ§ËÆæÁΩÆ';
        document.getElementById('newPasswordInput').value = '';
      } else {
        if (password === state.firstPassword) {
          savePassword(state.currentRole, password);
          localStorage.setItem('userRole', state.currentRole);
          closeNewPasswordModal();
          showMainPage('homePage');
          showToast('ÂØÜÁ†ÅÈáçÁΩÆÊàêÂäü ‚ú®');
        } else {
          showError('newPwdError', 'newPasswordInput', '‰∏§Ê¨°ÂØÜÁ†Å‰∏ç‰∏ÄËá¥');
          state.firstPassword = '';
          document.getElementById('newPwdTitle').textContent = CONFIG.names[state.currentRole] + 'ÔºåËÆæÁΩÆÊñ∞ÂØÜÁ†Å';
          document.getElementById('newPwdBtn').textContent = '‰∏ã‰∏ÄÊ≠•';
        }
      }
    }

    // ==================== Âà†Èô§ÂèåÈáçÈ™åËØÅ ====================
    function showDeleteModal(type = 'diary', id = null) {
      if (!hasPassword('cat') || !hasPassword('dog')) {
        showToast('ÈúÄË¶Å‰∏§‰∫∫ÈÉΩËÆæÁΩÆÂØÜÁ†ÅÂêéÊâçËÉΩ‰ΩøÁî®Ê≠§ÂäüËÉΩ');
        return;
      }
      
      state.deleteStep = 1;
      state.deleteType = type;
      state.deleteId = id || state.currentDiaryId;
      updateDeleteModal();
      document.getElementById('deleteModal').classList.add('active');
      setTimeout(() => document.getElementById('deletePasswordInput').focus(), 300);
    }

    function updateDeleteModal() {
      const role = state.deleteStep === 1 ? 'cat' : 'dog';
      document.getElementById('deleteIcon').textContent = CONFIG.emojis[role];
      document.getElementById('deleteTitle').textContent = 'ËØ∑' + CONFIG.names[role] + 'ËæìÂÖ•ÂØÜÁ†Å';
      document.getElementById('deleteSubtitle').textContent = 'Âà†Èô§ÈúÄË¶Å‰∏§‰∫∫Á°ÆËÆ§Ôºà' + state.deleteStep + '/2Ôºâ';
      document.getElementById('deletePasswordInput').value = '';
      clearError('deletePasswordError', 'deletePasswordInput');
    }

    function closeDeleteModal() {
      document.getElementById('deleteModal').classList.remove('active');
      state.deleteStep = 1;
    }

    function confirmDelete() {
      const password = document.getElementById('deletePasswordInput').value;
      const passwords = getPasswords();
      const role = state.deleteStep === 1 ? 'cat' : 'dog';

      if (password === passwords[role]) {
        if (state.deleteStep === 1) {
          state.deleteStep = 2;
          updateDeleteModal();
          showToast(CONFIG.names[role] + 'Á°ÆËÆ§ÈÄöËøá ‚úì');
        } else {
          // ÊâßË°åÂà†Èô§
          if (state.deleteType === 'diary') {
            state.diaries = state.diaries.filter(d => d.id !== state.deleteId);
          } else if (state.deleteType === 'anniversary') {
            state.anniversaries = state.anniversaries.filter(a => a.id !== state.deleteId);
          } else if (state.deleteType === 'event') {
            state.events = state.events.filter(e => e.id !== state.deleteId);
          }
          saveData();
          closeDeleteModal();
          showToast('Âà†Èô§ÊàêÂäü üíî');
          
          if (state.deleteType === 'diary') {
            renderDiaryList();
            goBack();
          } else {
            renderAnniversaries();
            renderCalendar();
            renderCalendarContent();
          }
          updateStats();
        }
      } else {
        showError('deletePasswordError', 'deletePasswordInput', 'ÂØÜÁ†Å‰∏çÂØπÂì¶');
      }
    }

    // ==================== Êó•ËÆ∞Áõ∏ÂÖ≥ ====================
    function renderDiaryList() {
      const list = document.getElementById('diaryList');
      let diaries = [...state.diaries].sort((a, b) => new Date(b.date) - new Date(a.date));
      
      // Á≠õÈÄâ
      if (state.currentFilter !== 'all') {
        diaries = diaries.filter(d => d.author === state.currentFilter);
      }

      // ÊêúÁ¥¢
      const searchText = document.getElementById('searchInput').value.toLowerCase();
      if (searchText) {
        diaries = diaries.filter(d => 
          d.title.toLowerCase().includes(searchText) ||
          d.content.toLowerCase().includes(searchText) ||
          d.tags.some(t => t.toLowerCase().includes(searchText))
        );
      }

      if (diaries.length === 0) {
        list.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">üìù</div>
            <div class="empty-text">${searchText ? 'Ê≤°ÊúâÊâæÂà∞Áõ∏ÂÖ≥Êó•ËÆ∞' : 'ËøòÊ≤°ÊúâÊó•ËÆ∞ÔºåÂÜô‰∏ãÁ¨¨‰∏ÄÁØáÂêßÔΩû'}</div>
            ${!searchText ? '<button class="empty-btn" onclick="showMainPage(\'writePage\')">‚úèÔ∏è ÂºÄÂßãÂÜôÊó•ËÆ∞</button>' : ''}
          </div>
        `;
        return;
      }

      list.innerHTML = diaries.map(diary => {
        const date = new Date(diary.date);
        const dateStr = `${date.getMonth() + 1}Êúà${date.getDate()}Êó• ¬∑ ${['Âë®Êó•','Âë®‰∏Ä','Âë®‰∫å','Âë®‰∏â','Âë®Âõõ','Âë®‰∫î','Âë®ÂÖ≠'][date.getDay()]}`;
        const authorClass = diary.author;
        const authorText = diary.author === 'cat' ? 'üê± ÂñµÂñµÂÜôÁöÑ' : diary.author === 'dog' ? 'üê∂ Â∞èÂùèËõãÂÜôÁöÑ' : 'üíë ‰∏ÄËµ∑ÂÜôÁöÑ';
        const comments = diary.comments || [];
        
        return `
          <div class="diary-card" onclick="showDiaryDetail('${diary.id}')">
            <div class="diary-card-header">
              <span class="diary-date">${dateStr}</span>
              <span class="diary-mood">${CONFIG.moods[diary.mood]}</span>
            </div>
            <h3 class="diary-title">${diary.title}</h3>
            <span class="diary-author ${authorClass}">${authorText}</span>
            <p class="diary-preview">${diary.content}</p>
            <div class="diary-card-footer">
              <div class="diary-tags">
                ${diary.tags.slice(0, 3).map(t => `<span class="diary-tag">#${t}</span>`).join('')}
              </div>
              <div class="diary-stats">
                <span class="diary-stat">üí¨ ${comments.length}</span>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    function searchDiaries() {
      renderDiaryList();
    }

    function showDiaryDetail(id) {
      const diary = state.diaries.find(d => d.id === id);
      if (!diary) return;
      
      state.currentDiaryId = id;
      
      const date = new Date(diary.date);
      const dateStr = `${date.getFullYear()}Âπ¥${date.getMonth() + 1}Êúà${date.getDate()}Êó• ¬∑ ${['Âë®Êó•','Âë®‰∏Ä','Âë®‰∫å','Âë®‰∏â','Âë®Âõõ','Âë®‰∫î','Âë®ÂÖ≠'][date.getDay()]}`;
      const authorClass = diary.author;
      const authorText = diary.author === 'cat' ? 'üê± ÂñµÂñµÂÜôÁöÑ' : diary.author === 'dog' ? 'üê∂ Â∞èÂùèËõãÂÜôÁöÑ' : 'üíë ‰∏ÄËµ∑ÂÜôÁöÑ';
      const comments = diary.comments || [];

      document.getElementById('detailContent').innerHTML = `
        <div class="detail-meta">
          <span class="detail-date">${dateStr}</span>
          <span class="detail-author ${authorClass}">${authorText}</span>
          <span class="detail-mood">${CONFIG.moods[diary.mood]}</span>
        </div>
        <h1 class="detail-title">${diary.title}</h1>
        <div class="detail-text">${diary.content.split('\n').map(p => `<p>${p}</p>`).join('')}</div>
        <div class="detail-tags">
          ${diary.tags.map(t => `<span class="detail-tag">#${t}</span>`).join('')}
        </div>
        
        <div class="interaction-section">
          <h3 class="interaction-title">üí¨ Êàë‰ª¨ÁöÑÊÇÑÊÇÑËØù</h3>
          <div class="comments-list" id="commentsList">
            ${comments.map(c => renderComment(c)).join('')}
          </div>
          <div class="quick-actions">
            <button class="quick-action-btn" onclick="sendAction('üòò')">üòò</button>
            <button class="quick-action-btn" onclick="sendAction('ü§ó')">ü§ó</button>
            <button class="quick-action-btn" onclick="sendAction('ü•∞')">ü•∞</button>
            <button class="quick-action-btn" onclick="sendAction('üòΩ')">üòΩ</button>
            <button class="quick-action-btn" onclick="sendAction('üëâ')">üëâ</button>
            <button class="quick-action-btn" onclick="sendAction('ü•∫')">ü•∫</button>
          </div>
          <div class="comment-input-wrap">
            <input type="text" class="comment-input" id="commentInput" placeholder="ÂÜôÁÇπ‰ªÄ‰πà..." onkeyup="if(event.key==='Enter')sendComment()">
            <button class="send-btn" onclick="sendComment()">ÂèëÈÄÅ</button>
          </div>
        </div>
      `;

      showPage('detailPage');
    }

    function renderComment(comment) {
      if (comment.type === 'action') {
        return `
          <div class="comment-item action">
            <div class="comment-bubble">
              <div class="action-content">${CONFIG.emojis[comment.author]} ${CONFIG.names[comment.author]} ¬∑ ${comment.content}</div>
            </div>
          </div>
        `;
      }
      return `
        <div class="comment-item ${comment.author}">
          <div class="comment-bubble">
            <div class="comment-author">${CONFIG.emojis[comment.author]} ${CONFIG.names[comment.author]}ËØ¥</div>
            <div class="comment-text">${comment.content}</div>
            <div class="comment-time">${comment.time}</div>
          </div>
        </div>
      `;
    }

    function sendComment() {
      const input = document.getElementById('commentInput');
      const text = input.value.trim();
      if (!text) return;

      const diary = state.diaries.find(d => d.id === state.currentDiaryId);
      if (!diary) return;

      if (!diary.comments) diary.comments = [];
      
      const now = new Date();
      diary.comments.push({
        type: 'text',
        content: text,
        author: state.currentRole,
        time: `${now.getHours()}:${String(now.getMinutes()).padStart(2, '0')}`
      });

      saveData();
      input.value = '';
      
      const list = document.getElementById('commentsList');
      list.innerHTML = diary.comments.map(c => renderComment(c)).join('');
      list.scrollTop = list.scrollHeight;
      
      updateStats();
    }

    function sendAction(emoji) {
      const diary = state.diaries.find(d => d.id === state.currentDiaryId);
      if (!diary) return;

      if (!diary.comments) diary.comments = [];
      
      const actions = { 'üòò': 'mua~', 'ü§ó': 'Êä±Êä±', 'ü•∞': 'Êë∏Â§¥', 'üòΩ': 'Ëπ≠Ëπ≠', 'üëâ': 'Êà≥Êà≥', 'ü•∫': 'ÂìºÔΩû' };
      
      diary.comments.push({
        type: 'action',
        content: emoji + ' ' + actions[emoji],
        author: state.currentRole
      });

      saveData();
      
      const list = document.getElementById('commentsList');
      list.innerHTML = diary.comments.map(c => renderComment(c)).join('');
      list.scrollTop = list.scrollHeight;

      // Âä®ÁîªÊïàÊûú
      const btn = event.target;
      const rect = btn.getBoundingClientRect();
      for (let i = 0; i < 5; i++) {
        setTimeout(() => {
          const heart = document.createElement('div');
          heart.className = 'floating-heart';
          heart.textContent = emoji;
          heart.style.left = (rect.left + rect.width / 2 + (Math.random() - 0.5) * 40) + 'px';
          heart.style.top = rect.top + 'px';
          document.getElementById('heartAnimation').appendChild(heart);
          setTimeout(() => heart.remove(), 1200);
        }, i * 80);
      }

      showToast(emoji + ' ' + actions[emoji] + ' Â∑≤ÂèëÈÄÅ');
      updateStats();
    }

    // ==================== ÂÜôÊó•ËÆ∞ ====================
    function resetWriteForm() {
      document.getElementById('diaryDate').value = new Date().toISOString().split('T')[0];
      document.getElementById('diaryTitle').value = '';
      document.getElementById('diaryContent').value = '';
      
      document.querySelectorAll('#authorSelect .select-btn').forEach((btn, i) => {
        btn.classList.toggle('active', i === 0);
      });
      document.querySelectorAll('#moodSelect .select-btn').forEach((btn, i) => {
        btn.classList.toggle('active', i === 0);
      });
      document.querySelectorAll('#tagSelect .select-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      updateCharCount();
    }

    function updateCharCount() {
      const content = document.getElementById('diaryContent').value;
      const count = content.length;
      const countEl = document.getElementById('charCount');
      countEl.textContent = count + '/100Â≠ó';
      countEl.className = 'char-count ' + (count >= 100 ? 'ok' : 'warning');
    }

    function saveDiary() {
      const date = document.getElementById('diaryDate').value;
      const title = document.getElementById('diaryTitle').value.trim();
      const content = document.getElementById('diaryContent').value.trim();
      const author = document.querySelector('#authorSelect .select-btn.active').dataset.author;
      const mood = document.querySelector('#moodSelect .select-btn.active').dataset.mood;
      const tags = Array.from(document.querySelectorAll('#tagSelect .select-btn.active')).map(b => b.dataset.tag);

      if (!title) {
        showToast('Ê†áÈ¢ò‰∏çËÉΩ‰∏∫Á©∫Âì¶');
        return;
      }

      if (content.length < 100) {
        const hints = [
          "ÊâçÂÜô‰∫Ü " + content.length + " Â≠óÔºåÂÜçÂ§öËØ¥‰∏§Âè•ÂòõÔΩû ü•∫",
          "ËøôÂ∞±ÂÆå‰∫ÜÔºüTAÊÉ≥Âê¨Êõ¥Â§öÔºÅ‚ú®",
          "100Â≠óÈÉΩ‰∏çÂà∞ÔºåÊòØ‰∏çÊòØÂÅ∑Êáí‰∫ÜÔºü‰∫≤‰∫≤Âà∏-1 üòò",
          "Â≠óÊï∞‰∏çÂ§üÔºå‰ªäÊôö‰∏çËÆ∏Êä±Êä±ÔºÅü§ó",
          "ÂÜôËøô‰πàÂ∞ëÔºåÊòØ‰∏çÊòØ‰∏çÁà±Êàë‰∫ÜÔºüü•∫",
          "ÂÜçÂÜôÂÜôÂòõÔºåÊàëÊÉ≥Â§ö‰∫ÜËß£‰Ω†‰ªäÂ§©ÔΩû üíï"
        ];
        showToast(hints[Math.floor(Math.random() * hints.length)]);
        return;
      }

      const diary = {
        id: Date.now().toString(),
        date,
        title,
        content,
        author,
        mood,
        tags,
        comments: [],
        createdAt: new Date().toISOString()
      };

      state.diaries.push(diary);
      saveData();
      
      showToast('Êó•ËÆ∞‰øùÂ≠òÊàêÂäü ‚ú®');
      renderDiaryList();
      updateStats();
      showMainPage('homePage');
    }

    function cancelWrite() {
      showMainPage('homePage');
    }

    function editDiary() {
      showToast('ÁºñËæëÂäüËÉΩÂºÄÂèë‰∏≠...');
    }

    // ==================== Êó•ÂéÜ ====================
    function renderCalendar() {
      const year = state.calendarYear;
      const month = state.calendarMonth;
      
      document.getElementById('calendarMonth').textContent = `${year}Âπ¥${month + 1}Êúà`;
      
      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      const today = new Date();
      
      // Ëé∑ÂèñÂΩìÊúàÊúâÊó•ËÆ∞ÁöÑÊó•Êúü
      const diaryDates = new Set(
        state.diaries
          .filter(d => {
            const date = new Date(d.date);
            return date.getFullYear() === year && date.getMonth() === month;
          })
          .map(d => new Date(d.date).getDate())
      );

      let html = '';
      
      // Á©∫ÁôΩÊ†ºÂ≠ê
      for (let i = 0; i < firstDay; i++) {
        html += '<button class="calendar-day empty"></button>';
      }
      
      // Êó•ÊúüÊ†ºÂ≠ê
      for (let day = 1; day <= daysInMonth; day++) {
        const isToday = year === today.getFullYear() && month === today.getMonth() && day === today.getDate();
        const isSelected = state.selectedDate && 
          state.selectedDate.getFullYear() === year && 
          state.selectedDate.getMonth() === month && 
          state.selectedDate.getDate() === day;
        const hasDiary = diaryDates.has(day);
        
        let classes = 'calendar-day';
        if (isToday) classes += ' today';
        if (isSelected) classes += ' selected';
        if (hasDiary) classes += ' has-diary';
        
        html += `<button class="${classes}" onclick="selectDate(${year}, ${month}, ${day})">
          <span class="day-number">${day}</span>
        </button>`;
      }

      document.getElementById('calendarDays').innerHTML = html;
      renderCalendarContent();
    }

    function prevMonth() {
      state.calendarMonth--;
      if (state.calendarMonth < 0) {
        state.calendarMonth = 11;
        state.calendarYear--;
      }
      renderCalendar();
    }

    function nextMonth() {
      state.calendarMonth++;
      if (state.calendarMonth > 11) {
        state.calendarMonth = 0;
        state.calendarYear++;
      }
      renderCalendar();
    }

    function selectDate(year, month, day) {
      state.selectedDate = new Date(year, month, day);
      renderCalendar();
    }

    function renderCalendarContent() {
      const container = document.getElementById('calendarContent');
      const date = state.selectedDate || new Date();
      const dateStr = date.toISOString().split('T')[0];
      const dateDisplay = `${date.getFullYear()}Âπ¥${date.getMonth() + 1}Êúà${date.getDate()}Êó•`;

      // ÂΩìÂ§©Êó•ËÆ∞
      const dayDiaries = state.diaries.filter(d => d.date === dateStr);
      
      // ÂΩìÂ§©Á∫™ÂøµÊó•
      const dayAnniversaries = state.anniversaries.filter(a => {
        const aDate = new Date(a.date);
        return aDate.getMonth() === date.getMonth() && aDate.getDate() === date.getDate();
      });

      // ÂΩìÂ§©‰∫ãÈ°π
      const dayEvents = state.events.filter(e => e.date === dateStr);

      let html = '';

      // Êó•ËÆ∞ÈÉ®ÂàÜ
      if (dayDiaries.length > 0) {
        html += `
          <div class="calendar-section">
            <div class="calendar-section-title">üìù ÂΩìÂ§©Êó•ËÆ∞</div>
            ${dayDiaries.map(d => `
              <div class="calendar-card" onclick="showDiaryDetail('${d.id}')">
                <div class="calendar-card-header">
                  <span class="calendar-card-title">${d.title}</span>
                  <span class="calendar-card-tag">${CONFIG.moods[d.mood]}</span>
                </div>
                <div class="calendar-card-preview">${d.content.substring(0, 50)}...</div>
              </div>
            `).join('')}
          </div>
        `;
      }

      // Á∫™ÂøµÊó•ÈÉ®ÂàÜ
      if (dayAnniversaries.length > 0) {
        html += `
          <div class="calendar-section">
            <div class="calendar-section-title">üíï Á∫™ÂøµÊó•</div>
            ${dayAnniversaries.map(a => `
              <div class="calendar-card">
                <div class="calendar-card-header">
                  <span class="calendar-card-title">${a.icon} ${a.name}</span>
                </div>
              </div>
            `).join('')}
          </div>
        `;
      }

      // ‰∫ãÈ°πÈÉ®ÂàÜ
      html += `
        <div class="calendar-section">
          <div class="calendar-section-title">üìå ÈáçË¶Å‰∫ãÈ°π</div>
          ${dayEvents.map(e => `
            <div class="calendar-card" onclick="showDeleteModal('event', ${e.id})">
              <div class="calendar-card-header">
                <span class="calendar-card-title">${e.content}</span>
                <span class="calendar-card-tag">ÈïøÊåâÂà†Èô§</span>
              </div>
            </div>
          `).join('')}
          <button class="add-event-btn" onclick="showAddEventModal('${dateStr}', '${dateDisplay}')">
            <span>‚ûï</span> Ê∑ªÂä†‰∫ãÈ°π
          </button>
        </div>
      `;

      if (!dayDiaries.length && !dayAnniversaries.length && !dayEvents.length) {
        html = `
          <div class="calendar-section">
            <div class="empty-state" style="padding: 40px 20px;">
              <div class="empty-icon">üìÖ</div>
              <div class="empty-text">${dateDisplay}<br>ËøôÂ§©Ê≤°ÊúâËÆ∞ÂΩï</div>
              <button class="add-event-btn" onclick="showAddEventModal('${dateStr}', '${dateDisplay}')" style="margin-top: 16px;">
                <span>‚ûï</span> Ê∑ªÂä†‰∫ãÈ°π
              </button>
            </div>
          </div>
        `;
      }

      container.innerHTML = html;
    }

    function showAddEventModal(dateStr, dateDisplay) {
      state.eventDate = dateStr;
      document.getElementById('eventDateText').textContent = dateDisplay;
      document.getElementById('eventContent').value = '';
      document.getElementById('addEventModal').classList.add('active');
    }

    function closeAddEventModal() {
      document.getElementById('addEventModal').classList.remove('active');
    }

    function addEvent() {
      const content = document.getElementById('eventContent').value.trim();
      if (!content) {
        showToast('ËØ∑ËæìÂÖ•‰∫ãÈ°πÂÜÖÂÆπ');
        return;
      }

      state.events.push({
        id: Date.now(),
        date: state.eventDate,
        content
      });

      saveData();
      closeAddEventModal();
      renderCalendarContent();
      showToast('‰∫ãÈ°πÂ∑≤Ê∑ªÂä† ‚úì');
    }

    // ==================== Á∫™ÂøµÊó• ====================
    function renderAnniversaries() {
      const list = document.getElementById('anniversaryList');
      const today = new Date();
      
      const items = state.anniversaries.map(a => {
        const aDate = new Date(a.date);
        // ËÆ°ÁÆó‰∏ã‰∏Ä‰∏™Á∫™ÂøµÊó•
        let nextDate = new Date(today.getFullYear(), aDate.getMonth(), aDate.getDate());
        if (nextDate < today) {
          nextDate = new Date(today.getFullYear() + 1, aDate.getMonth(), aDate.getDate());
        }
        const daysLeft = Math.ceil((nextDate - today) / (1000 * 60 * 60 * 24));
        
        return { ...a, daysLeft };
      }).sort((a, b) => a.daysLeft - b.daysLeft);

      list.innerHTML = items.map(a => `
        <div class="anniversary-item" onclick="showDeleteModal('anniversary', ${a.id})">
          <div class="anniversary-icon">${a.icon}</div>
          <div class="anniversary-info">
            <div class="anniversary-name">${a.name}</div>
            <div class="anniversary-date">${a.date}</div>
          </div>
          <div class="anniversary-countdown">
            <div class="countdown-number">${a.daysLeft}</div>
            <div class="countdown-unit">Â§©Âêé</div>
          </div>
        </div>
      `).join('');

      updateStats();
    }

    function showAddAnniversaryModal() {
      document.getElementById('anniversaryName').value = '';
      document.getElementById('anniversaryDate').value = '';
      document.querySelectorAll('#iconSelect .icon-btn').forEach((btn, i) => {
        btn.classList.toggle('active', i === 0);
      });
      document.getElementById('addAnniversaryModal').classList.add('active');
    }

    function closeAddAnniversaryModal() {
      document.getElementById('addAnniversaryModal').classList.remove('active');
    }

    function addAnniversary() {
      const name = document.getElementById('anniversaryName').value.trim();
      const date = document.getElementById('anniversaryDate').value;
      const icon = document.querySelector('#iconSelect .icon-btn.active').dataset.icon;

      if (!name || !date) {
        showToast('ËØ∑Â°´ÂÜôÂÆåÊï¥‰ø°ÊÅØ');
        return;
      }

      state.anniversaries.push({
        id: Date.now(),
        name,
        date,
        icon
      });

      saveData();
      closeAddAnniversaryModal();
      renderAnniversaries();
      showToast('Á∫™ÂøµÊó•Â∑≤Ê∑ªÂä† üíï');
    }

    // ==================== ÊàëÁöÑÈ°µÈù¢ ====================
    function updateMinePageInfo() {
      document.getElementById('currentRole').textContent = CONFIG.emojis[state.currentRole] + ' ' + CONFIG.names[state.currentRole];
    }

    function updateStats() {
      const totalComments = state.diaries.reduce((sum, d) => sum + (d.comments?.length || 0), 0);
      document.getElementById('statDiaries').textContent = state.diaries.length;
      document.getElementById('statComments').textContent = totalComments;
      document.getElementById('statAnniversaries').textContent = state.anniversaries.length;
    }

    function switchRole() {
      const newRole = state.currentRole === 'cat' ? 'dog' : 'cat';
      selectIdentity(newRole);
    }

    function showResetPasswordModal() {
      state.firstPassword = '';
      document.getElementById('newPwdIcon').textContent = CONFIG.emojis[state.currentRole];
      document.getElementById('newPwdTitle').textContent = '‰øÆÊîπÂØÜÁ†Å';
      document.getElementById('newPwdSubtitle').textContent = 'ËØ∑ËæìÂÖ•Êñ∞ÁöÑÂØÜÁ†ÅÔºàËá≥Â∞ë8‰ΩçÔºâ';
      document.getElementById('newPwdBtn').textContent = '‰∏ã‰∏ÄÊ≠•';
      document.getElementById('newPasswordInput').value = '';
      clearError('newPwdError', 'newPasswordInput');
      document.getElementById('newPasswordModal').classList.add('active');
    }

    function exportData() {
      const data = {
        diaries: state.diaries,
        anniversaries: state.anniversaries,
        events: state.events,
        exportedAt: new Date().toISOString()
      };
      
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'Êàë‰ª¨ÁöÑÊó•ËÆ∞Êú¨_Â§á‰ªΩ_' + new Date().toISOString().split('T')[0] + '.json';
      a.click();
      URL.revokeObjectURL(url);
      
      showToast('Êï∞ÊçÆÂ∑≤ÂØºÂá∫ üì§');
    }

    function showAboutModal() {
      document.getElementById('aboutModal').classList.add('active');
    }

    function closeAboutModal() {
      document.getElementById('aboutModal').classList.remove('active');
    }

    function logout() {
      localStorage.removeItem('userRole');
      state.currentRole = null;
      showPage('welcomePage');
      showToast('Â∑≤ÈÄÄÂá∫ÁôªÂΩï');
    }

    // ==================== Â∑•ÂÖ∑ÂáΩÊï∞ ====================
    function updateDaysCount() {
      const start = new Date(CONFIG.togetherDate);
      const today = new Date();
      const days = Math.floor((today - start) / (1000 * 60 * 60 * 24));
      
      document.getElementById('homeDays').textContent = days;
      document.getElementById('togetherDays').textContent = days;
      document.getElementById('mineDays').textContent = days;
    }

    function showError(errorId, inputId, message) {
      const errorEl = document.getElementById(errorId);
      const input = document.getElementById(inputId);
      errorEl.textContent = message;
      errorEl.classList.add('show');
      input.classList.add('error');
      input.value = '';
      setTimeout(() => input.classList.remove('error'), 400);
    }

    function clearError(errorId, inputId) {
      document.getElementById(errorId).classList.remove('show');
      document.getElementById(inputId).classList.remove('error');
    }

    function showToast(message) {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = message;
      container.appendChild(toast);
      setTimeout(() => toast.classList.add('show'), 10);
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
      }, 2500);
    }

    function showStrangerModal() {
      document.getElementById('strangerModal').classList.add('active');
    }

    function closeStrangerModal() {
      document.getElementById('strangerModal').classList.remove('active');
    }

    // ÂàùÂßãÂåñ
    init();
  </script>
</body>
</html>
